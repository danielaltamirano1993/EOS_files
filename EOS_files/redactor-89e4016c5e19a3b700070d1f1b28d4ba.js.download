/*
	Redactor v8.0.2
	Updated: August 18, 2012

	http://redactorjs.com/

	Copyright (c) 2009-2012, Imperavi Inc.
	License: http://redactorjs.com/license/

	Usage: $('#content').redactor();
*/
function invokeRedactor(e,t,i){switch(e="class"==i?"."+e:"#"+e,t){case"ticket":jQuery(e).redactor({focus:!1,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"],imageUploadCallback:inlineImageUploadCallback});break;case"anonymous-ticket":jQuery(e).redactor({clipboardImageUpload:"/tickets_uploaded_images/create_file",convertDivs:!1,autoresize:!1,setFontSettings:!0,wrapFontSettings:Helpdesk.settings,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link"]});break;case"template":jQuery(e).redactor({focus:!1,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/ticket_templates_uploaded_images",clipboardImageUpload:"/ticket_templates_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"]});break;case"forum":jQuery(e).redactor({autoresize:!1,convertDivs:!1,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","video"],imageUpload:"/forums_uploaded_images",clipboardImageUpload:"/forums_uploaded_images/create_file",imageGetJson:"/forums_uploaded_images",imageUploadCallback:inlineImageUploadCallback});break;case"solution":jQuery(e).redactor({autoresize:!0,convertDivs:!1,allowTagsInCodeSnippet:!0,tabindex:2,imageUpload:"/solutions_uploaded_images",clipboardImageUpload:"/solutions_uploaded_images/create_file",imageGetJson:"/solutions_uploaded_images"});break;case"cnt-reply":jQuery(e).redactor({focus:!0,convertDivs:!1,autoresize:!1,observeImages:!0,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"],execCommandCallback:function(e,t){"undefined"!=typeof TICKET_DETAILS_DATA?"undefined"!=typeof TICKET_DETAILS_DATA.draft.clearingDraft&&TICKET_DETAILS_DATA.draft.clearingDraft?TICKET_DETAILS_DATA.draft.clearingDraft=!1:TICKET_DETAILS_DATA.draft.hasChanged=!0:isDirty=!0},keyupCallback:function(e,t){"undefined"!=typeof TICKET_DETAILS_DATA?"undefined"!=typeof TICKET_DETAILS_DATA.draft.clearingDraft&&TICKET_DETAILS_DATA.draft.clearingDraft?TICKET_DETAILS_DATA.draft.clearingDraft=!1:(isDirty=!0,TICKET_DETAILS_DATA.draft.hasChanged=!0):isDirty=!0},imageUploadCallback:inlineImageUploadCallback});case"cnt-fwd":jQuery(e).redactor({focus:!1,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"],imageUploadCallback:inlineImageUploadCallback});break;case"automation":jQuery(e).redactor({focus:!1,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"]});break;case"cnt-note":jQuery(e).redactor({focus:!0,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"],imageUploadCallback:inlineImageUploadCallback});break;case"cnt-broadcast":jQuery(e).redactor({focus:!0,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"],imageUploadCallback:inlineImageUploadCallback});break;case"bulk-reply":jQuery(e).redactor({focus:!1,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"],imageUploadCallback:inlineImageUploadCallback});break;case"signature":jQuery(e).redactor({focus:!1,convertDivs:!1,autoresize:!1,buttons:["bold","italic","underline","|","image","|","fontcolor","backcolor","|","link"]});default:jQuery(e).redactor({convertDivs:!1,autoresize:!1,setFontSettings:!0,wrapFontSettings:Helpdesk.settings,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link"]})}}var _0xf6db=["(6(){11 49=24;11 14={50:6(8,10){5 10.58(8)&92},57:6(8,10){7(8.58!=12){5 8.58(10)&16}46{5 8.57(10)}},55:6(8,18,10,20){7(8===10){5 18<=20}7(14.29(8)&&14.29(10)){5 14.50(8,10)}7(14.29(8)&&!14.29(10)){5!14.55(10,20,8,18)}7(!14.57(8,10)){5 14.50(8,10)}7(8.47.85<=18){5 40}7(8.47[18]===10){5 0<=20}5 14.50(8.47[18],10)},29:6(61){5(61!=12?61.93==3:40)},81:6(41){11 62=0;88(41=41.59){62++}5 62}};11 4=49.4=(6(){6 4(2){24.2=2}4.34.31=6(){5 4.31(24.2)};4.34.37=6(){5 4.37(24.2)};4.34.38=6(){5 4.38(24.2)};4.34.45=6(){5 4.45(24.2)};4.34.44=6(){5 4.44(24.2)};4.34.52=6(25,26,23,22){5 4.52(24.2,25,26,23,22)};4.34.51=6(){5 4.51(24.2)};5 4})();7(49.35){4.67=43;4.31=6(2){11 9;5(9=2.35())&&(9.63!=12)&&(9.36!=12)};4.37=6(2){11 9;7(!((9=2.35())&&(9.36!=12))){5 12}5[9.36,9.97]};4.38=6(2){11 9;7(!((9=2.35())&&(9.63!=12))){5 12}5[9.63,9.91]};4.45=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[8,18]}5[10,20]};4.44=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[10,20]}5[8,18]};4.52=6(2,25,26,23,22){11 9=2.35();7(!9){5}7(23==12){23=25}7(22==12){22=26}7(9.60&&9.79){9.60(25,26);9.79(23,22)}46{54=2.15.56();54.106(25,26);54.107(23,22);71{9.73()}80(41){}9.98(54)}};4.51=6(2){71{11 9=2.35();7(!9){5}9.73()}80(41){}}}46 7(49.15.39){11 69=6(42,32,30){11 19,13,21,33,64;13=42.90('89');19=32.103();19.60(30);64=19.77();88(43){64.86(13,13.59);19.82(13);7(!(19.87((30?'66':'83'),32)>0&&(13.59!=12))){99}}7(19.87((30?'66':'83'),32)===-1&&13.84){19.74((30?'100':'78'),32);21=13.84;33=19.101.85}46{21=13.48;33=14.81(13)}13.48.72(13);5[21,33]};11 68=6(42,32,30,21,33){11 36,65,19,13,53;53=0;36=14.29(21)?21:21.47[33];65=14.29(21)?21.48:21;7(14.29(21)){53=33}13=42.90('89');65.86(13,36||12);19=42.76.75();19.82(13);13.48.72(13);32.74((30?'66':'78'),19);5 32[30?'105':'104']('102',53)};4.67=43;4.31=6(2){11 17;2.70();7(!2.15.39){5 40}17=2.15.39.56();5 17&&17.77().15===2.15};4.45=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,43)};4.44=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,40)};4.37=6(2){5 4.45(2)};4.38=6(2){5 4.44(2)};4.52=6(2,25,26,23,22){7(23==12){23=25}7(22==12){22=26}11 17=2.15.76.75();68(2.15,17,40,23,22);68(2.15,17,43,25,26);5 17.96()};4.51=6(2){5 2.15.39.95()}}46{4.67=40}}).94(24);","|","split","||win||Selection|return|function|if|n1|sel|n2|var|null|cursorNode|Dom|document||range|o1|cursor|o2|node|foco|focn|this|orgn|orgo|_ref|_ref2|isText|bStart|hasSelection|textRange|offset|prototype|getSelection|anchorNode|getOrigin|getFocus|selection|false|e|doc|true|getEnd|getStart|else|childNodes|parentNode|root|isPreceding|clearSelection|setSelection|textOffset|r|isCursorPreceding|createRange|contains|compareDocumentPosition|previousSibling|collapse|d|k|focusNode|parent|anchorParent|StartToStart|supported|moveBoundary|getBoundary|focus|try|removeChild|removeAllRanges|setEndPoint|createTextRange|body|parentElement|EndToEnd|extend|catch|getChildIndex|moveToElementText|StartToEnd|nextSibling|length|insertBefore|compareEndPoints|while|a|createElement|focusOffset|0x02|nodeType|call|empty|select|anchorOffset|addRange|break|EndToStart|text|character|duplicate|moveEnd|moveStart|setStart|setEnd","replace","","\\w+","\\b","g"];eval(function(e,t,i,a,n,s){if(n=function(e){return e},!_0xf6db[5][_0xf6db[4]](/^/,String)){for(;i--;)s[i]=a[i]||i;a=[function(e){return s[e]}],n=function(){return _0xf6db[6]},i=1}for(;i--;)a[i]&&(e=e[_0xf6db[4]](new RegExp(_0xf6db[7]+n(i)+_0xf6db[7],_0xf6db[8]),a[i]));return e}(_0xf6db[0],10,108,_0xf6db[3][_0xf6db[2]](_0xf6db[1]),0,{}));var codeEditor_lang={html:"Html",css:"Css",js:"JavaScript",sass:"Sass",xml:"Xml",ruby:"Ruby",php:"PHP",java:"Java",csharp:"C#",cpp:"C++",objc:"Obj C",perl:"Perl",python:"Python",vbnet:"VB",sql:"SQL",text:"Generic Language"};if("undefined"==typeof RELANG)var RELANG={};var isMacintosh=navigator.appVersion.indexOf("Macintosh")>-1,ctrlkeyname=isMacintosh?"\u2318":"Ctrl-",shiftkeyname=isMacintosh?"\u21e7":"Shift-",altkeyname=isMacintosh?"-Alt-":"Alt-",RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold ("+ctrlkeyname+"B)",italic:"Italic ("+ctrlkeyname+"I)",fontcolor:"Font Color",fontname:"Font",fontsize:"Font Size",backcolor:"Back Color",unorderedlist:"Unordered List ("+ctrlkeyname+shiftkeyname+"7)",orderedlist:"Ordered List ("+ctrlkeyname+shiftkeyname+"8)",outdent:"Outdent ("+shiftkeyname+"Tab)",indent:"Indent (Tab)",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image URL",text:"Text",mailto:"Email",web:"URL",video_html_code:"Enter the video embed code, copied from popular websites like YouTube, Vimeo etc. here",file:"Insert File...",upload:"Upload",download:"Download",choose:"Select Existing",choose_text:"Showing recent 20 images",or_choose:"Or choose",drop_file_here:"...or Drop a file from your computer here",align_left:"Align Left ("+ctrlkeyname+shiftkeyname+"L)",align_center:"Align Center ("+ctrlkeyname+shiftkeyname+"E)",align_right:"Align Right ("+ctrlkeyname+shiftkeyname+"R)",align_justify:"Justify ("+ctrlkeyname+shiftkeyname+"J)",horizontalrule:"Insert Horizontal Rule",deleted:"Strikethrough",underline:"Underline ("+ctrlkeyname+"U)",anchor:"Anchor",link_new_tab:"Open link in new tab",removeformat:"Remove formatting ("+ctrlkeyname+"\\)",invalid_image_file:"Error occurred while uploading",confirm_remove_format_for_entire_content:"Converting the entire content to plain text will remove formatting and inserted items. Are you sure you want to continue?",codeEditor:"Code Snippet",codeEditor_html:"Enter code snippet and select language",label_lang:"Language : ",show_quoted_text:"Show Quoted text",supported_images:"Supported image formats are JPG,PNG,GIF and TIFF",select_file_to_upload:"Select a file to upload"},DEFAULT_LANG=jQuery.extend({},RLANG),uploaded_img_placeholder="undefined"==typeof FILLER_IMAGES?"/images/animated/image_upload_placeholder.gif":FILLER_IMAGES.imageLoading;!function(e){var t=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML};jQuery.fn.redactor=function(t){return this.each(function(){var a=e(this),n=a.data("redactor");n||a.data("redactor",n=new i(this,t))})};var i=function(t,i){this.redactor_copy_content,this.specialPaste=!1,this.textPaste=!1,this.undoDisable=!1,this.$el=e(t),this.cursorPlacementDelay=null,this.dataURI="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",this.imgTag=e("<img id='cursor' width='0' height='0' rel='cursor' src='"+this.dataURI+"'/>"),this.storedRange="",this.paste_supported_browser=1==e.browser.mozilla&&-1!=navigator.appVersion.indexOf("Win")||e.browser.webkit&&!/chrome/.test(navigator.userAgent.toLowerCase()),this.buildLangSelector(),"undefined"!=typeof i&&"undefined"!=typeof i.lang&&"en"!==i.lang&&"undefined"!=typeof RELANG[i.lang]&&(RLANG=RELANG[i.lang]);var a="undefined"!=typeof I18n?{link_new_tab:I18n.translate("common_js_translations.redactor.link_new_tab"),supported_images:I18n.translate("common_js_translations.redactor.supported_images"),select_file_to_upload:I18n.translate("common_js_translations.redactor.select_file_to_upload"),underline:I18n.translate("common_js_translations.redactor.underline")+"("+ctrlkeyname+"U)",confirm_remove_format_for_entire_content:I18n.translate("common_js_translations.redactor.confirm_remove_format_for_entire_content")}:{};RLANG=e.extend(DEFAULT_LANG,RLANG,a);var n=document.getElementsByTagName("html")[0].getAttribute("lang"),s=["ar","he"],r=s.indexOf(n)>=0?"rtl":"ltr";this.opts=e.extend({lang:"en",direction:r,mixedDirectionSupport:!0,callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,focus:!1,autoresize:!0,fixed:!1,source:!0,mobile:!0,air:!1,wym:!1,convertLinks:!0,convertDivs:!0,autosave:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,clipboardImageUpload:!1,imageLoadingCallback:!1,imageLoadedCallback:!1,fileUpload:!1,fileUploadCallback:!1,uploadCrossDomain:!1,uploadFields:!1,observeImages:!0,overlay:!0,allowedTags:["code","span","div","a","p","pre","hr","br","b","strong","i","em","del","strike","s","u","blockquote","q","img","video","audio","iframe","embed","object","param","mark","cite","small","big","ul","ol","li","dl","dt","dd","abbr","acronym","address","dfn","sup","sub","kbd","ins","samp","tt","details","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6","canvas","figure","figcaption","output","section","summary","time","col"],nonAllowedAttributes:{img:["onerror"]},blackListedStyles:["position"],toolbarExternal:!1,buttonsCustom:{},buttonsAdd:[],buttons:["formatting","fontname","fontsize","fontcolor","backcolor","bold","italic","underline","deleted","|","alignleft","aligncenter","alignright","justify","|","unorderedlist","orderedlist","indent","outdent","|","link","table","image","video","file","codeEditor","horizontalrule","|","removeFormat","|","html"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",s:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000","#808080","#00CCFF","#0000FF","#3366FF","#666699","#FF0000","#339966","#800080","#33CCCC","#008080","#FF9900"],fontnames:["Arial","Verdana","Helvetica","Helvetica Neue","Arial Black","Impact","Tahoma","Trebuchet MS","Terminal","Courier New","Comic Sans MS","Andale Mono","Georgia","Book Antiqua","Times New Roman","Symbol","Webdings","Windings"],fontsizes:[1,2,3,4,5],fontsize_levels:{1:10,2:13,3:16,4:18,5:24,6:32},fontsize_levels_reverse:{"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6},fontsize_naming:["Tiny","Small","Medium","Large","Huge"],allEmptyHtml:"<p><br /></p>\r\n",mozillaEmptyHtml:"<p>&nbsp;</p>\r\n",buffer:!1,visual:!0,setFontSettings:!1,wrapFontSettings:{"font-family":"'Helvetica Neue', Helvetica, Arial, sans-serif","font-size":"13px"},spanCleanupProperties:["color","font-family","font-size","font-weight"],allowTagsInCodeSnippet:!1,modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label for="redactor_filename">Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div class="mt7"><input type="file" id="redactor_file" name="file" /></div></form>',modal_image_edit:String()+'<label for="redactor_file_alt">'+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label for="redactor_file_link">'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label for="redactor_form_image_align">'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select><div id="redactor_modal_footer"><a href="javascript:void(null);" class="btn" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+'</a><span class="redactor_btns_box"><a href="javascript:void(null);" class="btn" id="redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="btn btn-primary" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" /></span></div>',modal_image:String()+'<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a><div id="redactor_image_choose_help_text">'+RLANG.choose_text+'</div></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><div class="custom-file-upload"><div class="file-upload"><span class="file-upload-text">'+RLANG.select_file_to_upload+'</span></div><input type="file" id="redactor_file" name="image[uploaded_data]" accept="image/*" /></div></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div><div class="custom-file-upload"><div class="file-upload"><span class="file-upload-text">'+RLANG.select_file_to_upload+'</span></div><input type="file" id="redactor_file" name="image[uploaded_data]" accept="image/*" /></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><input name="redactor_file_link" id="redactor_file_link" class="redactor_input" placeholder="'+RLANG.image_web_link+'"  /></div><div id="redactor_modal_footer"><span class="muted">'+RLANG.supported_images+'</span><span class="redactor_btns_box"><input type="button" class="btn" name="'+RLANG.cancel+'" id="redactor_btn_modal_close" value="'+RLANG.cancel+'" /><input type="button" class="btn btn-primary" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" /></span></div>',modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label for="redactor_link_url">URL</label><input id="redactor_link_url" class="redactor_input" /><label for="redactor_link_url_text">'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label for="redactor_link_blank"><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+'</label></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label for="redactor_link_mailto">Email</label><input id="redactor_link_mailto" class="redactor_input" /><label for="redactor_link_mailto_text">'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label for="redactor_link_anchor">'+RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  /><label for="redactor_link_anchor_text">'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" class="btn" name="'+RLANG.cancel+'" id="redactor_btn_modal_close" value="'+RLANG.cancel+'" /><input type="button" class="btn btn-primary" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /></span></div>',modal_video:String()+'<form id="redactorInsertVideoForm"><label for="redactor_insert_video_area">'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><a href="javascript:void(null);" class="btn" id="redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="btn btn-primary" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /></span></div>',modal_table:String()+'<label for="redactor_table_rows">'+RLANG.rows+'</label><input size="5" value="2" id="redactor_table_rows" /><label for="redactor_table_columns">'+RLANG.columns+'</label><input size="5" value="3" id="redactor_table_columns" /><div id="redactor_modal_footer"><span class="redactor_btns_box"><a href="javascript:void(null);" class="btn" id="redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="btn btn-primary" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /></span></div>',modal_codeEditor:String()+'<form id="redactorInsertCodeForm" class="redactorInsertCode" data-overlay-event=false ><label for="redactor_insert_text_area">'+RLANG.codeEditor_html+'</label><div class="redactorInsertCode_dropdown pull-right"><div class="vertical-alignment m6">'+RLANG.label_lang+"</div>"+RLANG.lang_selector+'</div><textarea id="redactor_insert_text_area" style="width: 99%; height: 250px;"></textarea><span style="color: #858585;">Note: Code highlighting will be applied on articles published on your portal.</span></form><div id="redactor_modal_footer"><a href="javascript:void(null);" class="btn" id="redactor_code_delete_btn" style="color: #000;">'+RLANG._delete+'</a><span class="redactor_btns_box"><a href="javascript:void(null);" class="btn" id="redactor_btn_modal_close">'+RLANG.cancel+'</a>  <input type="button" class="btn btn-primary" id="redactor_insert_code_btn" value="'+RLANG.save+'" /></span></div>',toolbar:{html:{title:RLANG.html,func:"toggle"},codeEditor:{title:RLANG.codeEditor,className:"addcode",func:"showCodeEditor"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},fontname:{title:RLANG.fontname,func:"showCurrentFont"},fontsize:{title:RLANG.fontsize,className:"fontSize_dropdown",func:"showCurrentFont"},removeFormat:{title:RLANG.removeformat,func:"buildremoveFormat"},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},underline:{title:RLANG.underline,exec:"underline"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"toggleTableOptions",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator",className:"table_optional"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove",className:"table_optional"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow",className:"table_optional"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft",className:"table_optional"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight",className:"table_optional"},separator_drop2:{name:"separator",className:"table_optional"},add_head:{title:RLANG.add_head,func:"addHead",className:"table_optional"},delete_head:{title:RLANG.delete_head,func:"deleteHead",className:"table_optional"},separator_drop3:{name:"separator",className:"table_optional"},delete_column:{title:RLANG.delete_column,func:"deleteColumn",className:"table_optional"},delete_row:{title:RLANG.delete_row,func:"deleteRow",className:"table_optional"},delete_table:{title:RLANG.delete_table,func:"deleteTable",className:"table_optional"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,titleText:"("+ctrlkeyname+"K)",func:"showLink"},unlink:{title:RLANG.unlink,titleText:"("+ctrlkeyname+shiftkeyname+"K)",exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},i,this.$el.data()),this.dropdowns=[],this.init()};i.prototype={init:function(){var t=["unorderedlist","orderedlist"];if(1==e.browser.opera)for(var i=0;i<t.length;i++){var a=this.opts.buttons.indexOf(t[i]);a>-1&&this.opts.buttons.splice(a,1)}if(e.event.props.push("clipboardData"),this.height=this.$el.css("height"),this.width=this.$el.css("width"),this.opts.mobile===!1&&this.isMobile())return this.build(!0),!1;if(this.opts.air)this.opts.buttons=this.opts.airButtons;else if(this.opts.toolbar!==!1){if(this.opts.source===!1){var a=this.opts.buttons.indexOf("html"),n=this.opts.buttons[a+1];this.opts.buttons.splice(a,1),"undefined"!=typeof n&&"|"===n&&this.opts.buttons.splice(a,1)}e.extend(this.opts.toolbar,this.opts.buttonsCustom),e.each(this.opts.buttonsAdd,e.proxy(function(e,t){this.opts.buttons.push(t)},this)),e.each(this.opts.blackListedStyles,e.proxy(function(e,t){this.allowedStylesCallbacks[t]=function(){return""}},this))}if(this.build(),this.enableAir(),this.buildToolbar(),this.opts.activeButtons!==!1&&this.opts.toolbar!==!1){var s=e.proxy(function(){this.observeFormatting()},this);this.$editor.click(s).keyup(s).keydown(s),this.$toolbar.click(s)}var r=e("body").find("[rel=tmpClipboard]");r.attr("contenteditable","true"),r.css("width","100px"),r.css("height","10px"),r.css("opacity","0"),r.css("overflow","hidden"),this.isMobile(!0)||(this.cleanStyleAttr(),1==e.browser.msie&&e.browser.msie&&parseInt(e.browser.version,10)<=10&&this.$editor.bind("beforepaste",e.proxy(function(){this.paste_selection_modification(r)},this)),this.$editor.bind("paste",e.proxy(function(t){if(this.setCursorPosition(),this.specialPaste)this.specialPaste=!1;else if(this.paste_supported_browser){var i=t.clipboardData.getData("text/plain");0==i.length&&this.opts.clipboardImageUpload!==!1?e(this).pasteImage(t):setTimeout(function(){this.paste_selection_modification(r)},1)}else if(e.browser.msie&&parseInt(e.browser.version,10)>10&&void 0!=window.clipboardData){var i=window.clipboardData.getData("Text");void 0!=i&&i.length>0?this.paste_selection_modification(r):this.opts.clipboardImageUpload!==!1&&e(this).pasteImage(t)}else{var i="";i=t.clipboardData.getData("text/html"),0==i.length&&(i=t.clipboardData.getData("text/plain"),this.textPaste=!0),0==i.length&&this.opts.clipboardImageUpload!==!1?(this.textPaste=!1,e(this).pasteImage(t)):(t.preventDefault(),this.pasteCleanUp(i))}this.saveScroll=e(window).scrollTop()},this)),e.browser.msie||this.$editor.bind("drop",e.proxy(function(t){t.preventDefault(),this.focusOnCursor(),e(this).pasteImage(t)},this))),this.keyup(),this.keydown(),this.bindclick(),this.bindCustomEvent(),e(this).removeCursorImage(this),this.opts.autosave!==!1&&this.autoSave(),this.observeImages(),this.observeTables(),this.observeCode(),this.opts.focus&&this.focusOnCursor(),this.opts.fixed&&(this.observeScroll(),e(document).scroll(e.proxy(this.observeScroll,this))),"function"==typeof this.opts.callback&&this.opts.callback(this);var o=this;this.inputEventAvailable()&&this.$editor.on("input",function(){o.syncCode()}),this.$editor.on("drop",function(){o.inputEventAvailable()||setTimeout(function(){o.syncCode()},1)}),this.$editor.on("blur",function(){o.syncCode(),o.$el.is(":hidden")&&o.insertCaretImage(),e(this).parent().removeClass("redactor_focus")}),this.$editor.on("focus",function(){e(this).parent().addClass("redactor_focus")}),this.$el.data("quotedTextarea")?(e(this).quotedtext(this),this.hasQuotedText=!0):this.hasQuotedText=!1,this.submitCleanup()},setCursorPosition:function(){if(this.$editor.find("[rel='cursor']").get(0)&&(e.browser.mozilla&&this.$editor.find("[rel='cursor']").removeAttr("style"),this.removeContent()),e.browser.mozilla||this.imgTag.css({display:"none"}),window.getSelection){var t=window.getSelection();if(t.rangeCount>0){var i=t.getRangeAt(0),a=document.createRange();a.setStart(t.focusNode,i.endOffset),this.storedRange=a}}},removeContent:function(){var e=this.$editor.find("[rel='cursor']").get(0);if(document.createRange&&e){var t=document.createRange();return t.selectNode(e),t.deleteContents(),!0}return!1},focusOnCursor:function(){var t=this.$editor.find("[rel='cursor']");if(t[0]){var i=document.createRange();i.selectNode(t[0]),this.getSelection().removeAllRanges(),this.getSelection().addRange(i),this.getSelection().collapseToEnd(),e.browser.mozilla&&this.$editor.focus()}else this.$editor.focus()},deleteCursor:function(){this.removeContent()&&this.syncCode()},addNoneStyleForCursor:function(){this.$editor.find("[rel='cursor']").get(0)&&(this.$editor.find("[rel='cursor']").css({display:"none"}),this.syncCode())},insertCaretImage:function(){this.storedRange&&this.storedRange.insertNode(this.imgTag[0])},removeTagOnLiquid:function(e){var e=this.$editor.html(),t=e.replace(/\{[^{]*}/g,this.replaceLiquidHtml).replace(/\{[^}]*}/g,this.replaceLiquidHtml).replace(/\{\%.*?\%\}|\{\{.*?\}\}?/gi,this.replaceLiquidHtml);return t},replaceLiquidHtml:function(e){return e.replace(/(<([^>]+)>)/gi,"")},insertOnCursorPosition:function(e,t){var i=this.getSelection(),a=i.toString?i.toString():i.text;""==a&&this.focusOnCursor(),this.execCommand(e,t),this.$editor.trigger({type:"textInserted",message:"success",time:new Date})},findDirection:function(e){var t="\x00-@[-`{-\xbf\xd7\xf7\u02b9-\u02ff\u2000-\u2bff\u2010-\u2029\u202c\u202f-\u2bff",i="\u0591-\u07ff\u200f\u202b\u202e\ufb1d-\ufdfd\ufe70-\ufefc",a=new RegExp("^["+t+"]*$"),n=new RegExp("^["+t+"]*["+i+"]");if(!a.test(e))return n.test(e)?"rtl":"ltr"},wrapElementWithFont:function(t){var i=e(t),a=e("<div />");return i.length>1||1==i.length&&i.not("div").length>0?i=e("<div />").css(this.opts.wrapFontSettings).html(t):i.attr("style")&&-1!=i.attr("style").indexOf("font-family")||i.css(this.opts.wrapFontSettings),this.opts.mixedDirectionSupport&&i.attr("dir",this.opts.direction),a.append(i),a.html()},wrapElementWithDirection:function(t){var i=e(t),a=e("<div />");return i.length>1||1==i.length&&i.not("div").length>0?i=e("<div dir='"+this.opts.direction+"'/>").html(t):i.attr("dir")||i.attr("dir",this.opts.direction),a.append(i),a.html()},changesInTextarea:function(){var e=this.$editor.html();this.opts.allowTagsInCodeSnippet||(e=this.removeTagOnLiquid(e)),void 0!=this.$el.data("wrapFontFamily")&&this.$el.data("wrapFontFamily")?e=this.wrapElementWithFont(e):this.opts.mixedDirectionSupport&&(e=this.wrapElementWithDirection(e)),
e=e.replace(/<p>\n<\/p>/g,"<p>&nbsp;</p>"),this.$el.val(e)},removeCursorImage:function(){if(this.$el.is(":hidden")){var e=this.$el.data("removeCursor");void 0==e||e?this.deleteCursor():jQuery.browser.mozilla&&this.$el.data("redactor").addNoneStyleForCursor(),this.changesInTextarea()}},shortcuts:function(e,t,i){e.preventDefault(),"removeFormat"==t?this.buildremoveFormat():"formatblock"==t?this.execCommand(t,i):"link"==t?this.showLink():this.execCommand(t,!1)},paste_selection_modification:function(t){this.saveSelection();var i=this.getSelection();i.removeAllRanges();var a=document.createRange();a.selectNodeContents(t.get(0)),i.addRange(a),setTimeout(e.proxy(function(){var e=t.html();t.html(""),this.restoreSelection(),this.pasteCleanUp(e)},this),1)},recursive_find:function(t){var i=this;t.contents().each(function(){e(this).get(0).isEqualNode(i.savedSel[0])&&(i.savedSel[0]=e(this).get(0)),e(this).get(0).isEqualNode(i.savedSelObj[0])&&(i.savedSelObj[0]=e(this).get(0)),i.recursive_find(e(this))}),t.find("*").each(function(){e(this).get(0).isEqualNode(i.savedSel[0])&&(i.savedSel[0]=e(this).get(0)),e(this).get(0).isEqualNode(i.savedSelObj[0])&&(i.savedSelObj[0]=e(this).get(0)),i.recursive_find(e(this))})},bindclick:function(){this.$editor.click(e.proxy(function(e){this.setCursorPosition()},this)),e.browser.mozilla&&this.$editor.dblclick(e.proxy(function(e){this.$editor.find("[rel='cursor']").css({display:"none"})},this))},bindCustomEvent:function(){this.$editor.on("textInserted",e.proxy(function(e){this.setCursorPosition()},this))},keyup:function(){this.$editor.keyup(e.proxy(function(t){var i=t.keyCode||t.which;if(40===i?(clearTimeout(this.cursorPlacementDelay),this.cursorPlacementDelay=setTimeout(e.proxy(function(){this.setCursorPosition()},this),500)):this.setCursorPosition(),"function"==typeof this.opts.keyupCallback&&this.opts.keyupCallback(this,t),8===i||46===i)return this.observeImages(),this.formatEmpty(t);if(13===i&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey)return this.formatNewLine(t);if(this.inputEventAvailable()||this.syncCode(),this.opts.mixedDirectionSupport){var a=e(this.getCurrentNode()),n=a.closest("p,div,blockquote,ul,ol"),s=n.text();if(!n.is(".redactor_editor")&&""!=s){var r=this.findDirection(s);r==this.opts.direction?n.removeAttr("dir"):r&&n.attr("dir",r)}}},this))},keydown:function(){this.$editor.keydown(e.proxy(function(t){var i=t.keyCode||t.which,a=this.getParentNode(),n=!1,s=t.ctrlKey||t.metaKey,r=t.shiftKey,o=t.altKey;if(a&&"PRE"===e(a).get(0).tagName&&(n=!0),this.$editor.find("[rel='cursor']").get(0)&&this.removeContent(),"function"==typeof this.opts.keydownCallback&&this.opts.keydownCallback(this,t),!o&&s&&(90===i?t.shiftKey?this.shortcuts(t,"redo"):this.shortcuts(t,"undo"):r?82===i?this.shortcuts(t,"JustifyRight"):76===i?this.shortcuts(t,"JustifyLeft"):69===i?this.shortcuts(t,"JustifyCenter"):74===i?this.shortcuts(t,"justifyfull"):55===i?this.shortcuts(t,"insertunorderedlist"):56===i?this.shortcuts(t,"insertorderedlist"):75===i?this.shortcuts(t,"unlink"):86===i&&(this.specialPaste=!0):220===i?this.shortcuts(t,"removeFormat"):66===i?this.shortcuts(t,"bold"):73===i?this.shortcuts(t,"italic"):76===i||(72===i?this.shortcuts(t,"subscript"):85===i?this.shortcuts(t,"underline"):37===i?isMacintosh&&e.browser.mozilla&&(t.preventDefault(),this.getSelection().modify("move","backward","lineboundary")):75===i&&this.shortcuts(t,"link"))),s||90===i||(this.opts.buffer=!1),n===!0&&13===i&&(t.preventDefault(),this.insertNodeAtCaret(document.createTextNode("\r\n"))),t.shiftKey||9!==i)t.shiftKey&&9===i&&this.shortcuts(t,"outdent");else if(e(this.getCurrentNode()).parents("table").length)t.preventDefault();else{if(n!==!1)return t.preventDefault(),this.insertNodeAtCaret(this.document.createTextNode("	")),this.syncCode(),!1;t.preventDefault()}return e.browser.webkit&&-1===navigator.userAgent.indexOf("Chrome")?this.safariShiftKeyEnter(t,i):void 0},this))},build:function(t){if(t!==!0){this.$box=e('<div class="redactor_box"></div>'),this.opts.air&&(this.air=e('<div class="redactor_air" style="display: none;"></div>')),this.textareamode=!0,"TEXTAREA"===this.$el.get(0).tagName?this.$editor=e("<div></div>"):(this.textareamode=!1,this.$editor=this.$el,this.$el=e('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height)),this.$editor.addClass("redactor_editor").attr("contenteditable",!0).attr("dir",this.opts.direction),this.opts.wym===!0&&this.$editor.addClass("redactor_editor_wym"),this.opts.autoresize===!1&&this.$editor.css("height",this.height),this.opts.setFontSettings&&this.$editor.css(this.opts.wrapFontSettings),this.$el.hide();var i="";this.textareamode?(i=this.$el.val(),this.$box.insertAfter(this.$el).append(this.$editor).append(this.$el)):(i=this.$editor.html(),this.$box.insertAfter(this.$editor).append(this.$el).append(this.$editor)),e("body").append('<div rel="tmpClipboard" />'),e('<div rel="getPasteImage" contenteditable="true" style="width:50px;height:0px; overflow: hidden;">').insertBefore(this.$editor),i=this.paragraphy(i),this.$editor.html(i),this.textareamode===!1&&this.syncCode()}else if("TEXTAREA"!==this.$el.get(0).tagName){var i=this.$el.val(),a=e('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(i);this.$el.hide(),this.$el.after(a)}},enableAir:function(){return this.opts.air===!1?!1:(this.air.hide(),this.$editor.bind("textselect",e.proxy(function(e){this.showAir(e)},this)),void this.$editor.bind("textunselect",e.proxy(function(){this.air.hide()},this)))},isNotEmpty:function(t){this.deleteCursor();var i,a=["img","iframe","object","embed"];i=this.$el.is(":visible")?e("<div>").html(this.$el.val()):this.$editor;for(var n=0;n<a.length;n++)if(0!=i.find(a[n]).length)return!0;return""!==i.text().trim()},showAir:function(t){e(".redactor_air").hide();var i=this.air.innerWidth(),a=t.clientX;e(document).width()<a+i&&(a-=i),this.air.css({left:a+"px",top:t.clientY+e(document).scrollTop()+14+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html()),this.$el.trigger("redactor:sync")},setCode:function(e){this.$editor.html(e).focus(),this.syncCode()},getCode:function(){return this.opts.visual?this.$editor.html():this.$el.val()},insertHtml:function(e){this.execCommand("inserthtml",e),this.observeImages()},destroy:function(){var t=this.getCode();this.textareamode?(this.$box.after(this.$el),this.$box.remove(),this.$el.height(this.height).val(t).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",!1).html(t).show()),this.opts.toolbarExternal&&e(this.opts.toolbarExternal).empty(),e(".redactor_air").remove();for(var i=0;i<this.dropdowns.length;i++)this.dropdowns[i].remove(),delete this.dropdowns[i];this.hasQuotedText&&this.$quoted.destroy()},observeFormatting:function(){var t=this.getCurrentNode();this.inactiveAllButtons(),e.each(this.opts.activeButtonsStates,e.proxy(function(i,a){0!=e(t).closest(i,this.$editor.get()[0]).length&&this.setBtnActive(a)},this));var i=e(t).closest(["p","div","h1","h2","h3","h4","h5","h6","blockquote","td"]);if("undefined"!=typeof i[0]&&"undefined"!=typeof i[0].elem&&0!=e(i[0].elem).length){var a=e(i[0].elem).css("text-align");switch(a){case"right":this.setBtnActive("alignright");break;case"center":this.setBtnActive("aligncenter");break;case"justify":this.setBtnActive("justify");break;default:this.setBtnActive("alignleft")}}},showCurrentFont:function(){var t=this.getParentNode();e.browser.opera||(e(".redactor_font_link").find("span").remove(),this.observeFontStyle(t,"font-family"),this.observeFontStyle(t,"font-size"))},observeFontStyle:function(t,i){var a=e(t).css(i)||this.$editor.css(i);a=a.split(",")[0],"font-size"==i?(e.browser.msie&&(a=a.replace("px","").split(".")[0]+"px"),element=e("[rel="+this.opts.fontsize_levels_reverse[a]+"].redactor_font_link")):element=e("[rel="+a+"].redactor_font_link"),element.length&&element.html("<span class='icon ticksymbol'></span>"+element.html())},observeImages:function(){return this.opts.observeImages===!1?!1:void this.$editor.find("img").each(e.proxy(function(t,i){e.browser.msie&&e(i).attr("unselectable","on"),"cursor"!=e(i).attr("id")&&this.resizeImage(i)},this))},observeTables:function(){this.$editor.find("table").click(e.proxy(this.tableObserver,this))},observeScroll:function(){var t=e(document).scrollTop(),i=this.$box.offset().top;t>i?(this.fixed=!0,this.$toolbar.css({position:"fixed",width:"100%",zIndex:100})):(this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto",zIndex:1}))},setBuffer:function(){this.saveSelection()},getBuffer:function(){return this.opts.buffer===!1?!1:(e.browser.msie||this.restoreSelection(),void(this.opts.buffer=!1))},execCommand:function(i,a){try{if(("undo"==i||"redo"==i)&&this.undoDisable)return;var n;if("inserthtml"===i&&e.browser.msie)window.getSelection?this.pasteHtmlAtCaret(a):document.selection.createRange().pasteHTML(a);else if("formatblock"===i&&e.browser.msie)document.execCommand(i,!1,"<"+a+">");else if("unlink"===i)n=this.getParentNode(),"A"===e(n).get(0).tagName?e(n).replaceWith(t(e(n).text())):document.execCommand(i,!1,a);else if("formatblock"===i&&"blockquote"===a)if(n=this.getParentNode(),"BLOCKQUOTE"===e(n).get(0).tagName)document.execCommand(i,!1,"p");else if("P"===e(n).get(0).tagName){var s=e(n).parent();if("BLOCKQUOTE"===e(s).get(0).tagName){var r=e("<p>"+e(n).html()+"</p>");e(s).replaceWith(r),this.setFocusNode(r.get(0))}else document.execCommand(i,!1,a)}else document.execCommand(i,!1,a);else if("formatblock"===i&&"pre"===a)n=this.getParentNode(),"PRE"===e(n).get(0).tagName?e(n).replaceWith("<p>"+e(n).text()+"</p>"):document.execCommand(i,!1,a);else if("forecolor"==i||"BackColor"==i||"fontName"==i||"hilitecolor"==i||"backcolor"==i||"fontSize"==i){1==e.browser.msie;try{document.execCommand("styleWithCSS",!1,!0),document.execCommand(i,!1,a),document.execCommand("styleWithCSS",!1,!1)}catch(o){document.execCommand(i,!1,a)}}else"undo"!=i&&"redo"!=i||1!=e.browser.msie?(document.execCommand(i,!1,a),"undo"!=i&&"redo"!=i||!this.hasQuotedText||this.$quoted.checkQuotedText(),"redo"==i&&e('pre[rel="highlighter"]').length>0&&e('pre[rel="highlighter"]').attr("contenteditable",!1)):document.execCommand(i);"inserthorizontalrule"===i&&this.$editor.find("hr").removeAttr("id"),this.syncCode(),this.oldIE()&&this.$editor.focus(),"function"==typeof this.opts.execCommandCallback&&this.opts.execCommandCallback(this,i),this.opts.air&&this.air.hide()}catch(o){console.log("Error ",o)}},pasteHtmlAtCaret:function(e){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0),range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i,a,n=document.createDocumentFragment();i=t.firstChild;)a=n.appendChild(i);range.insertNode(n),a&&(range=range.cloneRange(),range.setStartAfter(a),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}},formatNewLine:function(t){if(!e.browser.webkit)return this.syncCode(),!0;var i=this.getParentNode();if("DIV"!==i.nodeName||"redactor_editor"!==i.className)return this.syncCode(),!0;t.preventDefault();var a=e(this.getCurrentNode());if("DIV"===a.get(0).tagName&&(""===a.html()||"<br>"===a.html())){var n=e("<p>").append(a.clone().get(0).childNodes);return a.replaceWith(n),n.html("<br />"),this.setFocusNode(n.get(0)),this.syncCode(),!1}this.syncCode(),this.opts.convertLinks&&this.$editor.linkify()},safariShiftKeyEnter:function(t,i){if(t.shiftKey&&13===i){t.preventDefault();var a=e("<span><br /></span>");return this.insertNodeAtCaret(a.get(0)),this.syncCode(),!1}return!0},formatEmpty:function(t){var i=e.trim(this.$editor.html());if(e.browser.mozilla&&(i=i.replace(/<br>/i,"")),""===i){t.preventDefault();var a=this.opts.allEmptyHtml;e.browser.mozilla&&(a=this.opts.mozillaEmptyHtml);var n=e(a).get(0);return this.$editor.html(n),this.setFocusNode(n),this.syncCode(),!1}this.syncCode()},paragraphy:function(t){if(t=e.trim(t),""===t)return e.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml;this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var i=function(e,t,i){return e.replace(new RegExp(t,"g"),i)},a=function(e,a){return i(t,e,a)},n="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return t+="\n",a("<br />\\s*<br />","\n\n"),a("(<"+n+"[^>]*>)","\n$1"),a("(</"+n+">)","$1\n\n"),a("\r\n|\r","\n"),a("\n\n+","\n\n"),a("\n?((.|\n)+?)$","<p>$1</p>\n"),a("<p>\\s*?</p>",""),a("<p>(<div[^>]*>\\s*)","$1<p>"),a("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2"),a("<p>\\s*(</?"+n+"[^>]*>)\\s*</p>","$1"),a("<p>(<li.+?)</p>","$1"),a("<p>\\s*(</?"+n+"[^>]*>)","$1"),a("(</?"+n+"[^>]*>)\\s*</p>","$1"),a("(</?"+n+"[^>]*>)\\s*<br />","$1"),a("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),-1!=t.indexOf("<pre")&&a("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(e,t,a,n){return i(t,"\\\\(['\"\\\\])","$1")+i(i(i(n,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"}),a("\n</p>$","</p>")},stripTags:function(t){var i=this.opts.allowedTags,a=this.opts.nonAllowedAttributes;1==e.browser.webkit&&-1==navigator.appVersion.indexOf("Win")&&(i[i.length]="style");var n=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,s=/(\S+\s?)=[\s"']?((?:.(?!["']?\s+(?:\S+)\s?=|[>"']))+.)[\s"']?/gi;return t.replace(n,function(t,n){if(e.inArray(n.toLowerCase(),i)>"-1"){var r=n;return t.replace(s,function(t,i){return e.inArray(i.toLowerCase(),a[r])>"-1"?"":t})}return""})},pasteCleanUp:function(t){0==this.textPaste?(t=this.onPasteFromWord(t),t=this.onPasteFromExcel(t),t=this.sanitizeContent(t),t=InlineImagesValidator.cleanSvg(t),t=this.normalizeContent(t).html(),this.execCommand("inserthtml",t)):(this.textPaste=!1,this.execCommand("inserttext",t));var i=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);(i||e.browser.msie)&&e(window).scrollTop(this.saveScroll)},onPasteFromWord:function(e){return e=e.replace(/<!--[\s\S]*?-->/gi,""),e=e.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(e)&&(e=e.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),e=e.replace(/src="file\:\/\/(.*?)"/,'src=""'),e=e.replace(/p(.*?)class=MsoListParagraphCxSpFirst ([\w\W]*?)\/p|p(.*?)class="MsoListParagraphCxSpFirst" ([\w\W]*?)\/p/gi,this.removeIndentForList),e=e.replace(/p(.*?)class=MsoListParagraphCxSpMiddle ([\w\W]*?)\/p|p(.*?)class="MsoListParagraphCxSpMiddle" ([\w\W]*?)\/p/gi,this.removeIndentForList),e=e.replace(/p(.*?)class=MsoListParagraphCxSpLast ([\w\W]*?)\/p|p(.*?)class="MsoListParagraphCxSpLast" ([\w\W]*?)\/p/gi,this.removeIndentForList),e=e.replace(/p(.*?)class=MsoListParagraph ([\w\W]*?)\/p|p(.*?)class="MsoListParagraph" ([\w\W]*?)\/p/gi,this.removeIndentForList),e=e.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2")),e},removeIndentForList:function(e){return e.replace(/text-indent:.*?\;/,"")},onPasteFromExcel:function(e){return/(microsoft-com|schemas-microsoft-com:office:excel|content=Excel.Sheet)/.test(e)&&(e=e.replace(/<table(.*?)border=0/,"<table$1 border=1")),e},sanitizeContent:function(t){this.opts.convertDivs,t=t.replace(/(&nbsp;){2,}/gi,"&nbsp;");t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),t=t.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,"");var i=t.match(/<body(.*?) ([\w\W]*?)<\/body>/g);null!=i&&(t=i[0]),t=t.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),t=t.replace(/\[td\]/gi,"<td>&nbsp;</td>"),t=t.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),t=t.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),t=t.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),t=t.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),t=t.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),t=t.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),t=t.replace(/\[param(.*?)\]/gi,"<param$1>"),t=t.replace(/\[img(.*?)\]/gi,"<img$1>"),t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"),t=t.replace(/<\/div><p>/gi,"<p>"),t=t.replace(/<\/p><\/div>/gi,"</p>"),t=t.replace(/<p><p>/g,"<p>"),t=t.replace(/<\/p><\/p>/g,"</p>"),t=this.stripTags(t),t=this.cleanParagraphy(t),t=t.replace(/\n{3,}/gi,"\n"),e.browser.msie&&document.documentMode>=9&&(t=t.replace(/\n/g," "),t=t.replace(/>\s+</g,"><"));var a="strong",n="em";return t=t.replace(/<span style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<"+n+">$1</"+n+">"),t=t.replace(/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<"+a+">$1</"+a+">"),t=t.replace(/<strong>([\w\W]*?)<\/strong>/gi,"<b>$1</b>"),t=t.replace(/<em>([\w\W]*?)<\/em>/gi,"<i>$1</i>"),t=t.replace(/<strike>([\w\W]*?)<\/strike>/gi,"<del>$1</del>")},normalizeContent:function(t){var i=e("<div></div>").html(t),a=this;return i.find("*").each(function(t,i){var n=e(i);a.normalizeAttributes(n)}),i.find("p span:only-child").each(function(){jQuery.trim(jQuery(this).text()).length||jQuery(this).html("&nbsp;")}),i},normalizeAttributes:function(e){return e.removeAttr("class"),this.filterDomProperty(e,"style"),this.filterDomProperty(e,"align"),this.resetAttributes(e),e},filterDomProperty:function(e,t){var i=e.attr(t),a=this;if(i)switch(e.removeAttr(t),t){case"align":e.css("text-align",i);break;case"style":a.normalizeStyleAttribute(e,i)}},tagProperties:{TABLE:"border-collapse:collapse; border:1px solid #afafaf;"},resetAttributes:function(e){var t=this.tagProperties[e.prop("tagName")];t&&e.attr("inline-styles",t)},allowedStylesCallbacks:{"mso-highlight":function(e,t){e.css("background-color",t)},"font-family":function(e,t,i){i.setFontSettings?e.css("font-family",t+","+i.wrapFontSettings["font-family"]):e.css("font-family",t)},background:function(t,i){var a=e.browser.msie||e.browser.mozilla,n=a?"background-color":"background";t.css(n,i)},"text-align":function(t,i){e.browser.mozilla?(t.attr("align",i),t.css("text-align","")):t.css("text-align",i)}},normalizeStyleAttribute:function(t,i){var a=i.split(/[;]/),n=this;e.each(a,function(i,a){var s=a.split(":").map(e.trim),r=s[0].toLowerCase(),o=s[1],l=n.allowedStylesCallbacks[r];"undefined"!=typeof l?l(t,o,n.opts):t.css(r,o)})},cleanParagraphy:function(t){function i(e,i,a){return t.replace(new RegExp(e,i),a)}if(t=e.trim(t),""===t||"<p></p>"===t)return t;t+="\n";var a=[],n=0;if(-1!==t.search(/<(table|div|pre|object)/gi)){var s=t.match(/<(table|div|pre|object)(.*?)>([\w\W]*?)<\/(table|div|pre|object)>/gi);null!=s&&e.each(s,function(e,i){e++,a[e]=i,t=t.replace(i,"{replace"+e+"}\n")})}t=t.replace(/<\!\-\-([\w\W]*?)\-\->/gi,"<comment>$1</comment>"),t=t.replace(/<br \/>\s*<br \/>/gi,"\n\n");var r="(comment|html|body|head|title|meta|style|script|link|iframe|table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|option|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary)";t=i("(<"+r+"[^>]*>)","gi","\n$1"),t=i("(</"+r+">)","gi","$1\n\n"),t=i("\r\n","g","\n"),t=i("\r","g","\n"),t=i("/\n\n+/","g","\n\n");var o=t.split(new RegExp("\ns*\n","g"),-1);t="";for(var n in o)o.hasOwnProperty(n)&&(t+=-1==o[n].search("{replace")?o[n].replace(/^\n+|\n+$/g,""):o[n]);if(-1!==t.search(/<blockquote/gi)){var l=t.match(/<blockquote(.*?)>([\w\W]*?)<\/blockquote>/gi);null!=l&&e.each(l,function(e,i){var a="";a=i.replace("<p>",""),a=a.replace("</p>","<br>"),t=t.replace(i,a)})}return t=i("<p>s*</p>","gi",""),t=i("<p>([^<]+)</(div|address|form)>","gi","<p>$1</p></$2>"),t=i("<p>s*(</?"+r+"[^>]*>)s*</p>","gi","$1"),t=i("<p>(<li.+?)</p>","gi","$1"),t=i("<p>s*(</?"+r+"[^>]*>)","gi","$1"),t=i("(</?"+r+"[^>]*>)s*</p>","gi","$1"),t=i("(</?"+r+"[^>]*>)s*<br />","gi","$1"),t=i("<br />(s*</?(?:p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","gi","$1"),t=i("\n</p>","gi","</p>"),t=i("</li><p>","gi","</li>"),t=i("</ol><p>","gi","</ol>"),t=i("<p>	?\n?<p>","gi","<p>"),t=i("</dt><p>","gi","</dt>"),t=i("</dd><p>","gi","</dd>"),t=i("<br></p></blockquote>","gi","</blockquote>"),e.each(a,function(e,i){t=t.replace("{replace"+e+"}",i)}),t=t.replace(/<comment>([\w\W]*?)<\/comment>/gi,"<!--$1-->"),e.trim(t)},formattingRemove:function(t){var i=[],a=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==a&&e.each(a,function(e,a){t=t.replace(a,"prebuffer_"+e),i.push(a)}),t=t.replace(/\s{2,}/g," "),t=t.replace(/\n/g," "),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g,""),t=t.replace(/[\s\n]*$/g,""),t=t.replace(/>\s+</g,"><"),i&&(e.each(i,function(e,i){t=t.replace("prebuffer_"+e,i)}),i=[]),t},formattingIndenting:function(e){return e=e.replace(/<li/g,"	<li"),e=e.replace(/<tr/g,"	<tr"),e=e.replace(/<td/g,"		<td"),e=e.replace(/<\/tr>/g,"	</tr>")},formattingEmptyTags:function(e){for(var t=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<div>\\s*</div>"],i=0;i<t.length;++i){var a=t[i];e=e.replace(new RegExp(a,"gi"),"")}return e},formattingAddBefore:function(e){for(var t="\r\n",i=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"],a=0;a<i.length;++a){var n=i[a];e=e.replace(new RegExp(n,"gi"),t+n)}return e},formattingAddAfter:function(e){for(var t="\r\n",i=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"],a=0;a<i.length;++a){var n=i[a];e=e.replace(new RegExp(n,"gi"),n+t)}return e},formatting:function(e){return e=this.formattingRemove(e),e=this.formattingEmptyTags(e),e=this.formattingAddBefore(e),e=this.formattingAddAfter(e),e=this.formattingIndenting(e)},selectionToggle:function(){this.$editor.html(this.$el.val())},toggle:function(){var t;this.opts.visual?(this.deleteCursor(),this.$editor.hide(),t=this.$editor.html(),t=e.trim(this.formatting(t)),this.$el.height(this.$editor.innerHeight()).val(t).show().focus(),this.$toolbar.find("li").each(function(){(void 0==e(this).attr("class")||"redactor_separator"==e(this).attr("class"))&&e(this).hide()}),this.setBtnActive("html"),this.opts.visual=!1):(this.$el.hide(),this.$editor.show(),""===this.$editor.html()&&(t=e.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml,this.$el.val(t)),this.selectionToggle(),this.$toolbar.find("li").each(function(){(void 0==e(this).attr("class")||"redactor_separator"==e(this).attr("class"))&&e(this).show()}),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables(),this.observeCode())},autoSave:function(){setInterval(e.proxy(function(){e.post(this.opts.autosave,{data:this.getCode()})},this),1e3*this.opts.interval)},buildToolbar:function(){return this.opts.toolbar===!1?!1:(this.$toolbar=e("<ul>").addClass("redactor_toolbar"),this.opts.air?(e(this.air).append(this.$toolbar),e("body").prepend(this.air)):this.opts.toolbarExternal===!1?this.$box.prepend(this.$toolbar):e(this.opts.toolbarExternal).html(this.$toolbar),e.each(this.opts.buttons,e.proxy(function(t,i){if("|"!==i&&"undefined"!=typeof this.opts.toolbar[i]){var a=this.opts.toolbar[i];if(this.opts.fileUpload===!1&&"file"===i)return!0;var n=e("<li>"),s=this.buildButton(i,a);if("backcolor"===i||"fontcolor"===i||"undefined"!=typeof a.dropdown||"fontname"===i||"fontsize"===i){var r=e('<div class="redactor_dropdown" style="display: none;">');r="backcolor"===i||"fontcolor"===i?this.buildColorPicker(r,i):"fontname"===i?this.buildFontNamePicker(r,i):"fontsize"===i?this.buildFontSizePicker(r,i):this.buildDropdown(r,a.dropdown),this.dropdowns.push(r.appendTo(e(document.body))),this.hdlHideDropDown=e.proxy(function(e){this.hideDropDown(e,r,i)},this),this.hdlShowDropDown=e.proxy(function(t){e.browser.opera||this.$editor.focus(),this.showDropDown(t,r,i)},this),s.click(this.hdlShowDropDown)}"html"==i&&e(n).attr("class","button_right"),this.$toolbar.append(e(n).append(s)),"html"==i&&this.$toolbar.append(e('<li class="redactor_separator button_right"></li>'))}"|"===i&&this.$toolbar.append(e('<li class="redactor_separator"></li>'))},this)),e(document).click(this.hdlHideDropDown),void this.$editor.click(this.hdlHideDropDown))},buildButton:function(t,i){var a=e('<a href="javascript:void(null);" title="'+i.title+'" class="redactor_btn_'+t+'" tabindex="-1"><span class="hide">'+i.title+"</span></a>");return"undefined"==typeof i.func?a.click(e.proxy(function(e){this.insertOnCursorPosition(i.exec,t)},this)):"show"!==i.func&&a.click(e.proxy(function(e){"redactor_btn_removeFormat"!=e.currentTarget.className&&"redactor_btn_fontsize"!=e.currentTarget.className&&"redactor_btn_fontname"!=e.currentTarget.className?this.focusOnCursor():this.$editor.focus(),this[i.func](e)},this)),"undefined"!=typeof i.callback&&a.click(e.proxy(function(e){this.focusOnCursor(),i.callback(this,e,t)},this)),a},buildDropdown:function(t,i){return e.each(i,e.proxy(function(i,a){"undefined"==typeof a.className&&(a.className=""),"undefined"==typeof a.titleText&&(a.titleText="");var n;"undefined"!=typeof a.name&&"separator"===a.name?n=e('<a class="redactor_separator_drop '+a.className+' ">'):(n=e('<a href="javascript:void(null);" class="'+a.className+'" title = "'+a.titleText+'">'+a.title+"</a>"),"undefined"==typeof a.func?e(n).click(e.proxy(function(){this.execCommand(a.exec,i)},this)):e(n).click(e.proxy(function(e){this[a.func](e)},this))),e(t).append(n)},this)),t},buildColorPicker:function(t,i){var a;a="backcolor"===i?e.browser.msie?"BackColor":"hilitecolor":"forecolor",e(t).width(210);for(var n=this.opts.colors.length,s=0;n>s;++s){var r=this.opts.colors[s],o=e('<a rel="'+r+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:r});e(t).append(o);var l=this;e(o).click(function(){l.execCommand(a,e(this).attr("rel"))})}return t},buildFontNamePicker:function(t,i){e(t).width(210),e(t).height(175);for(var a=this.opts.fontnames.length,n=0;a>n;++n){var s=this.opts.fontnames[n],r=e('<a rel="'+s+'" href="javascript:void(null);" class="redactor_font_link">'+s+"</a>").css({"font-family":s});("Symbol"===s||"Webdings"===s)&&r.css({"font-family":"Helvetica Neue"}),e(t).append(r);var o=this;e(r).click(function(){o.execCommand("fontName",e(this).attr("rel"))})}return t},buildFontSizePicker:function(t,i){e(t).width(210),e(t).height(190);for(var a=this.opts.fontsizes.length,n=0;a>n;++n){var s=this.opts.fontsize_levels[this.opts.fontsizes[n]],r=this.opts.fontsizes[n],o=this.opts.fontsize_naming[n],l=e('<a rel="'+r+'" href="javascript:void(null);" class="redactor_font_link '+o+'" >'+o+" </a>").css({"font-size":s,"line-height":s+8+"px"});e(t).append(l);var c=this;e(l).click(function(){c.execCommand("fontSize",Number(e(this).attr("rel")))})}return t},buildremoveFormat:function(){var t;if(""==this.getSelectedHtml())confirm(RLANG.confirm_remove_format_for_entire_content)&&(t=this.removeFormatGetSelection(),t=e.browser.msie?t.replace(/\n+/g,"</p><p>"):t.replace(/\n+/g,"<br /></p><p>"),this.execCommand("selectAll",null),this.execCommand("inserthtml","<p>"+t));else{t=this.removeFormatGetSelection(),t=t.replace(/^\n+|\n+$/,"");var i=e("<span />");i.css({"font-family":this.$editor.css("font-family"),"font-size":this.$editor.css("font-size"),color:this.$editor.css("color"),"background-color":this.$editor.css("background-color")}),i.attr("rel","tempredactor");var a=t;t="";var n=0;e.each(a.split("\n"),function(){if(""!=e.trim(this.toString())){1==n?t+=e.browser.msie?"</p><p>":"<br /></p><p>":n=1,i.html(this.toString());var a=e("<span />").html(i);t+=a.html()}}),t=t.replace(/\n+/g,"<br/>"),(e.browser.mozilla||e.browser.msie)&&(t=t.split("").reverse().join("").replace(/\>p\</,"").split("").reverse().join("")),this.insertHtml(t)}this.syncCode()},removeFormatGetSelection:function(){if(this.execCommand("removeFormat",""),""==this.getSelectedHtml())var t=e("<span>"+this.getCode()+"</span>");else var t=e("<span>"+this.getSelectedHtml()+"</span>");return t.html(this.formatting(t.html())),replacehtml=t.text().replace(/\n+/g,"\n").replace(/</g,"&lt;").replace(/>/g,"&gt;"),replacehtml},showDropDown:function(t,i,a){if(this.getBtn(a).hasClass("dropact"))this.hideAllDropDown();else{this.hideAllDropDown(),this.setBtnActive(a),this.getBtn(a).addClass("dropact");var n=this.getBtn(a).offset().left;if(this.opts.air){var s=this.air.offset().top;e(i).css({position:"absolute",left:n+"px",top:s+30+"px"}).show()}else if(this.opts.fixed&&this.fixed)e(i).css({position:"fixed",left:n+"px",top:"30px"}).show();else{var r=this.$toolbar.offset().top+30;e(i).css({position:"absolute",left:n+"px",top:r+"px"}).show()}}},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact"),e(".redactor_dropdown").hide()},hideDropDown:function(t,i,a){e(t.target).hasClass("dropact")||(e(i).removeClass("act"),this.showedDropDown=!1,this.hideAllDropDown())},getSelection:function(){return"undefined"!=typeof window.getSelection?document.getSelection():"undefined"!=typeof document.selection?document.selection.createRange():void 0},getFragmentHtml:function(e){var t=e.cloneNode(!0),i=document.createElement("div");return i.appendChild(t),i.innerHTML},extractContent:function(){for(var e,t=this.$editor.get(0),i=document.createDocumentFragment();e=t.firstChild;)i.appendChild(e);return i},saveSelection:function(){if(this.savedSel=null,this.savedSelObj=null,e.browser.msie&&parseInt(e.browser.version,10)<9){var t=this.$editor.get(0);this.savedSel=window.Selection.getOrigin(t),this.savedSelObj=window.Selection.getFocus(t)}else{e.browser.msie&&parseInt(e.browser.version,10)>10&&(this.undoDisable=!0);var i=this.getSelection();this.savedSel=[],this.savedSelObj=[],this.savedSel[0]=i.anchorNode,this.savedSel[1]=i.anchorOffset,this.savedSelObj[0]=i.focusNode,this.savedSelObj[1]=i.focusOffset}},restoreSelection:function(){null!==this.savedSel&&null!==this.savedSelObj&&"BODY"!==this.savedSel[0].tagName?window.Selection.setSelection(window,this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]):this.$editor.focus()},getParentNode:function(){try{if("undefined"!=typeof window.getSelection){var e=window.getSelection();return e.rangeCount>0?this.getSelection().getRangeAt(0).startContainer.parentNode:!1}if("undefined"!=typeof document.selection)return this.getSelection().parentElement()}catch(t){}},getCurrentNode:function(){try{if("undefined"!=typeof window.getSelection)return this.getSelection().getRangeAt(0).startContainer;if("undefined"!=typeof document.selection)return this.getSelection()}catch(e){}},setFocusNode:function(e){if("undefined"==typeof e)return!1;try{var t=document.createRange(),i=this.getSelection();null!==i&&(t.selectNodeContents(e),i.addRange(t),i.collapse(e,0)),this.$editor.focus()}catch(a){}},insertNodeAtCaret:function(e){if(window.getSelection){var t=this.getSelection();if(t.rangeCount){var i=t.getRangeAt(0);i.collapse(!1),i.insertNode(e),i=i.cloneRange(),i.selectNodeContents(e),i.collapse(!1),t.removeAllRanges(),t.addRange(i)}}else if(document.selection){var a=1===e.nodeType?e.outerHTML:e.data,n="marker_"+(""+Math.random()).slice(2);a+='<span id="'+n+'"></span>';var s=this.getSelection();s.collapse(!1),s.pasteHTML(a);var r=document.getElementById(n);s.moveToElementText(r),s.select(),r.parentNode.removeChild(r)}},getSelectedHtml:function(){var e="";if(window.getSelection){var t=window.getSelection();if(t.rangeCount){for(var i=document.createElement("div"),a=0,n=t.rangeCount;n>a;++a)i.appendChild(t.getRangeAt(a).cloneContents());e=i.innerHTML}}else document.selection&&"Text"===document.selection.type&&(e=document.selection.createRange().htmlText);return e},cleanStyleAttr:function(){this.$editor.on("DOMNodeInserted",e.proxy(function(t){if(e(t.target).attr("style"))for(var i=e(t.target).attr("style").split(";"),a=0;a<i.length;a++)if(i[a]){var n=i[a].split(":");this.compareParentStyles(e(t.target),n[0])}if(e(t.target).attr("style")&&0==e(t.target).attr("style").length&&e(t.target).removeAttr("style"),this.setInlineAttributes(t),this.opts.mixedDirectionSupport){var s=e(t.target),r=s.text();if(s.is("p,div:not(.redactor_editor),blockquote,ul,ol")){var o=this.findDirection(r);o==this.opts.direction?s.removeAttr("dir"):o&&s.attr("dir",o)}}},this))},setInlineAttributes:function(t){var i=e(t.target),a=i.attr("inline-styles"),n=i.attr("style"),s=this;
if(a){var r=s.convertStylesToHash(a),o=s.convertStylesToHash(n);n+=" "+a;var l=e.extend(r,o);i.attr("style",s.convertHashToStyle(l)),i.removeAttr("inline-styles")}},convertHashToStyle:function(t){var i="";return e.each(t,function(e,a){i+=e+": "+t[e]+"; "}),i},convertStylesToHash:function(t){var i=t.split(/;/),a={};return e.each(i,function(e,t){var i=t.split(/:/),n=(i[0]||"").replace(/^\s+|\s+$/g,""),s=(i[1]||"").replace(/^\s+|\s+$/g,"");n&&""!=n&&(a[n]=s)}),a},submitCleanup:function(){var t=this.$editor.closest("form");e(t).on("submit",e.proxy(function(){},this))},getBtn:function(t){return e(this.$toolbar.find("a.redactor_btn_"+t))},setBtnActive:function(e){this.getBtn(e).addClass("act")},setBtnInactive:function(e){this.getBtn(e).removeClass("act")},inactiveAllButtons:function(){e.each(this.opts.activeButtons,e.proxy(function(e,t){this.setBtnInactive(t)},this))},resizeImage:function(t){var i,a,n=!1,s=!1,r=e(t).width()/e(t).height(),o=10,l=10;e(t).off(".redactor"),e(t).on({"mouseleave.redactor":function(){n=!1},"mousedown.redactor":function(r){r.preventDefault(),n=!0,s=!0,i=Math.round(r.pageX-e(t).eq(0).offset().left),a=Math.round(r.pageY-e(t).eq(0).offset().top)},"mouseup.redactor":e.proxy(function(e){n=!1,this.syncCode()},this),"click.redactor":e.proxy(function(e){s&&this.imageEdit(e)},this),"mousemove.redactor":function(c){if(n){s=!1;var d=(Math.round(c.pageX-e(this).eq(0).offset().left)-i,Math.round(c.pageY-e(this).eq(0).offset().top)-a),u=e(t).height(),p=parseInt(u,10)+d,h=p*r;h>o&&e(t).width(h),p>l&&(e(t).attr("height",p+"px"),e(t).attr("data-height",p)),i=Math.round(c.pageX-e(this).eq(0).offset().left),a=Math.round(c.pageY-e(this).eq(0).offset().top)}}})},toggleTableOptions:function(){e(".table_optional").toggle(0!=e(this.getCurrentNode()).parents("table").length)},showTable:function(){this.saveSelection(),this.modalInit(RLANG.table,"table",300,e.proxy(function(){e("#redactor_insert_table_btn").click(e.proxy(this.insertTable,this))},this),function(){e("#redactor_table_rows").focus()})},insertTable:function(){for(var t=e("#redactor_table_rows").val(),i=e("#redactor_table_columns").val(),a=e("<div></div>"),n=Math.floor(99999*Math.random()),s=e('<table id="table'+n+'" style="border-collapse:collapse; border:1px solid #afafaf;width:100%;" border="1" cellspacing="0" cellpadding="0"><tbody></tbody></table>'),r=0;t>r;r++){for(var o=e("<tr></tr>"),l=0;i>l;l++){var c=e("<td><br></td>");e(o).append(c)}e(s).append(o)}e(a).append(s);var d=e(a).html()+"<p></p>";this.restoreSelection(),this.execCommand("inserthtml",d),this.modalClose(),this.observeTables()},tableObserver:function(t){this.$table=e(t.target).parents("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$table_td.removeClass("current"),this.$tbody=e(t.target).parents("tbody"),this.$thead=e(this.$table).find("thead"),this.$current_td=e(t.target),this.$current_td.addClass("current"),this.$current_tr=e(t.target).parents("tr")},deleteTable:function(){e(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){e(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var t=e(this.$current_td).get(0).cellIndex;e(this.$table).find("tr").each(function(){e(this).find("td").eq(t).remove()}),this.syncCode()},addHead:function(){if(0!==e(this.$table).find("thead").length)this.deleteHead();else{var t=e(this.$table).find("tr").first().clone();t.find("td").html("&nbsp;"),this.$thead=e("<thead></thead>"),this.$thead.append(t),e(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){e(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(t){var i=e(this.$current_tr).clone();i.find("td").html("&nbsp;"),"after"===t?e(this.$current_tr).after(i):e(this.$current_tr).before(i),this.syncCode()},insertColumn:function(t){var i=0;this.$current_td.addClass("current"),this.$current_tr.find("td").each(function(t,a){e(a).hasClass("current")&&(i=t)}),this.$table_tr.each(function(a,n){var s=e(n).find("td").eq(i),r=s.clone();r.html("&nbsp;"),"after"===t?e(s).after(r):e(s).before(r)}),this.syncCode()},showCodeEditor:function(t){this.saveSelection(),this.selectedEvent=t,this.modalInit(RLANG.codeEditor,"codeEditor",650,e.proxy(function(){e("#redactor_insert_code_btn").click(e.proxy(this.insertCode,this)),"PRE"==e(t.target)[0].tagName?(e("#redactorInsertCode_selector").find("option").each(function(i,a){e(this).val()==e(t.target).attr("data-code-brush")&&e(this).prop("selected","selected")}),e("#redactor_code_delete_btn").removeClass("hide"),e("#redactor_code_delete_btn").click(e.proxy(function(){this.deleteElement(e(t.target))},this))):e("#redactor_code_delete_btn").addClass("hide"),setTimeout(function(){void 0!=jQuery.fn.tabby?e("#redactor_insert_text_area").focus().tabby():e("#redactor_insert_text_area").focus()},200)},this))},insertCode:function(){this.restoreSelection();var t=e("#redactor_insert_text_area").val(),i=t.split(/\r|\r\n|\n/),a="";if(i.length>10&&(a="code-large"),e.browser.msie&&(parseInt(e.browser.version,10)<9||parseInt(e.browser.version,10)>10)){var n=e(this.selectedEvent.target);n.is("pre")?(n.attr("code-brush",e("#redactorInsertCode_selector").val()).text(t),n.toggleClass("code-large",""!=a&&null!=a)):this.appendCodeTag(t,a)}else{var s=e(this.getSelection().anchorNode).parent();if(s.is("pre")){var r=document.createRange();r.selectNode(s[0]),this.getSelection().removeAllRanges(),this.getSelection().addRange(r),this.appendCodeTag(t,a)}else this.appendCodeTag(t,a)}this.observeCode(),this.modalClose()},observeCode:function(){this.getBtn("codeEditor").get(0)&&(this.$editor.find("pre").each(e.proxy(function(t,i){e(i).attr("contenteditable",!1),e(i).off("click"),e(i).on("click",e.proxy(function(t){this.showCodeEditor(t),e.browser.msie&&parseInt(e.browser.version,10)<9?e("#redactor_insert_text_area").val(e(i).html().replace(/&lt;/g,"<").replace(/&gt;/g,">")):e("#redactor_insert_text_area").val(e(i).text())},this))},this)),this.syncCode())},buildLangSelector:function(){var t='<select id="redactorInsertCode_selector" name="highlight-brush-type" data-minimum-results-for-search="100" class="select2 input-medium">';e.each(codeEditor_lang,function(e,i){t+='<option value="'+e+'">'+i+"</option>"}),t+="</select>",RLANG.lang_selector=t},appendCodeTag:function(t,i){var a=e("<div />");a.append(e("<p />").html("&nbsp;")),a.append(e("<pre />").attr("rel","highlighter").attr("data-code-brush",e("#redactorInsertCode_selector").val()).addClass(i).text(t)),a.append(e("<p />").html("&nbsp;")),this.execCommand("inserthtml",a.html())},showVideo:function(){this.saveSelection(),this.modalInit(RLANG.video,"video",600,e.proxy(function(){e("#redactor_insert_video_btn").click(e.proxy(this.insertVideo,this)),e("#redactor_insert_video_area").focus()},this))},insertVideo:function(){var t=e("#redactor_insert_video_area").val();t=this.stripTags(t),this.restoreSelection(),this.execCommand("inserthtml",t),this.modalClose()},setDefaultSelection:function(){if(!this.getSelection().getRangeAt(0).commonAncestorContainer.isEqualNode(this.$editor.get(0))){var e=this.getSelection();e.removeAllRanges();var t=document.createRange();t.setStart(this.$editor.get(0),0),t.setEnd(this.$editor.get(0),0),e.addRange(t)}},insertExternal:function(t){this.$editor.focus(),this.setDefaultSelection();var i=e(this.stripTags(t)).get(0);this.execCommand("inserthtml",this.stripTags(t));var a=this.getSelection(),n=document.createRange();a.removeAllRanges(),this.$editor.find("iframe").each(function(){e(this).attr("src")==e(i).attr("src")&&(n.selectNode(e(this).get(0)),n.collapse(!1),a.addRange(n))}),this.syncCode()},imageEdit:function(t){var i=e(t.target),a=i.parent(),n=e.proxy(function(){e("#redactor_file_alt").val(i.attr("alt")),e("#redactor_image_edit_src").attr("href",i.attr("src")),e("#redactor_form_image_align").val(i.css("float")),"A"===e(a).get(0).tagName&&e("#redactor_file_link").val(e(a).attr("href")),e("#redactor_image_delete_btn").click(e.proxy(function(){this.deleteElement(i)},this)),e("#redactorSaveBtn").click(e.proxy(function(){this.imageSave(i)},this))},this);this.modalInit(RLANG.image,"image_edit",380,n)},deleteElement:function(t){e(t).remove(),this.modalClose(),this.syncCode()},imageSave:function(t){var i=e(t).parent();e(t).attr("alt",e("#redactor_file_alt").val());var a=e("#redactor_form_image_align").val();"left"===a?e(t).css({"float":"left",margin:"0 10px 10px 0"}):"right"===a?e(t).css({"float":"right",margin:"0 0 10px 10px"}):e(t).css({"float":"none",margin:"0"});var n=e.trim(e("#redactor_file_link").val());if(""!==n)if("A"!==e(i).get(0).tagName){var s=e("<a >").attr("href",n).html(this.outerHTML(t)).get(0).outerHTML;e(t).replaceWith(s)}else e(i).attr("href",n);else"A"===e(i).get(0).tagName&&e(i).replaceWith(this.outerHTML(t));this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){this.saveSelection();var t=e.proxy(function(){if(this.opts.imageGetJson!==!1?e.getJSON(this.opts.imageGetJson,e.proxy(function(t){var i={},a=0;e.each(t,e.proxy(function(e,t){"undefined"!=typeof t.folder&&(a++,i[t.folder]=a)},this));var n=!1;if(e.each(t,e.proxy(function(t,a){var s="";"undefined"!=typeof a.title&&(s=a.title);var r=0;e.isEmptyObject(i)||"undefined"==typeof a.folder||(r=i[a.folder],n===!1&&(n=".redactorfolder"+r));var o=e("<a />").addClass("redactor_image_element").css({backgroundImage:"url('"+a.thumb+"')"});o.attr({rel:a.image,title:s,href:"javascript:void(null);"}),e("#redactor_image_box").append(o),e(o).click(e.proxy(this.imageSetThumb,this))},this)),!e.isEmptyObject(i)){e(".redactorfolder").hide(),e(n).show();var s=function(t){e(".redactorfolder").hide(),e(".redactorfolder"+e(t.target).val()).show()},r=e('<select id="redactor_image_box_select">');e.each(i,function(t,i){r.append(e('<option value="'+i+'">'+t+"</option>"))}),e("#redactor_image_box").before(r),r.change(s)}},this)):e("#redactor_tabs a").eq(1).remove(),this.opts.imageUpload!==!1)e("#redactor_image_choose_help_text").hide(),this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&0!==e("#redactor_file").length&&e("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:{_uniquekey:e.proxy(function(){return this.uniqueKey},this)},success:e.proxy(this.imageUploadCallback,this),error:e.proxy(this.imageUploadCallback,this),ondropCallback:e.proxy(this.insertLoadingAtCaret,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:e.proxy(this.imageUploadCallback,this)});else if(e(".redactor_tab").hide(),this.opts.imageGetJson===!1)e("#redactor_image_choose_help_text").hide(),e("#redactor_tabs").remove(),e("#redactor_tab3").show();else{var t=e("#redactor_tabs a");t.eq(0).remove(),t.eq(1).addClass("redactor_tabs_act"),e("#redactor_tab2").show()}e("#redactor_upload_btn").click(e.proxy(this.imageUploadCallbackLink,this))},this),i=e.proxy(function(){this.opts.imageUpload===!1&&this.opts.imageGetJson===!1?e("#redactor_file_link").focus():e("#redactor_upload_btn").hide()},this);this.modalInit(RLANG.image,"image",570,t,i,!0)},imageSetThumb:function(t){this._imageSet('<img src="'+e(t.target).attr("rel")+'" alt="'+e(t.target).attr("title")+'" />',!0)},imageUploadCallbackLink:function(){if(""!==e("#redactor_file_link").val()){var t=e("<img >").attr("src",e("#redactor_file_link").val()).get(0).outerHTML;this._imageSet(t,!0)}else this.modalClose()},imageUploadCallback:function(e){this._imageSet(e)},_imageSet:function(t,i){var a=!0;if(t!==!1){var n="",s="";if(i!==!0)if(t.isJSON()&&(s=e.parseJSON(t)),void 0!=s.filelink)n='<p><img src="'+s.filelink+'" class= "inline-image" data-id = "'+s.fileid+'" alt="image"  title="image"/></p>',this.$editor.find("#uploading_images_"+s.uniquekey).replaceWith(e(n)),this.syncCode(),0==this.$editor.find("img.image-loader").length&&("function"==typeof this.opts.imageLoadedCallback?this.opts.imageLoadedCallback(this):this.enableFormAfterLoadingImage());else{try{s.alert!==!1&&alert(JSON.parse(t).error||RLANG.invalid_image_file)}catch(r){alert(RLANG.invalid_image_file)}this.$editor.find("img.image-loader").remove(),"function"==typeof this.opts.imageLoadedCallback?this.opts.imageLoadedCallback(this):this.enableFormAfterLoadingImage(),a=!1}else n=t,this.modalClose(),this.restoreSelection(),InlineImagesValidator.link(n)&&this.execCommand("inserthtml",n);i!==!0&&"function"==typeof this.opts.imageUploadCallback&&this.opts.imageUploadCallback(this,s)}a&&this.observeImages()},showLink:function(){this.saveSelection();var t=e.proxy(function(){this.insert_link_node=!1;var t=this.getSelection(),i="",a="",n="";if(e.browser.msie){var s=this.getParentNode();"A"===s.nodeName?(this.insert_link_node=e(s),a=this.insert_link_node.text(),i=this.insert_link_node.attr("href"),n=this.insert_link_node.attr("target")):a=this.oldIE()?t.text:t.toString()}else t&&t.anchorNode&&"A"===t.anchorNode.parentNode.tagName?(i=e(t.anchorNode.parentNode).attr("href"),a=t.anchorNode.parentNode.text,n=t.anchorNode.parentNode.target,""===t.toString()&&(this.insert_link_node=t.anchorNode.parentNode)):a=t.toString();if(e(".redactor_link_text").val(a),i){var r=i.replace(window.location.href,"");0===i.search("mailto:")?(this.setModalTab(2),e("#redactor_tab_selected").val(2),e("#redactor_link_mailto").val(i.replace("mailto:",""))):0===r.search(/^#/gi)?(this.setModalTab(3),e("#redactor_tab_selected").val(3),e("#redactor_link_anchor").val(r.replace(/^#/gi,""))):e("#redactor_link_url").val(i)}"_blank"===n&&e("#redactor_link_blank").prop("checked",!0),e("#redactor_insert_link_btn").click(e.proxy(this.insertLink,this))},this),i=function(t){e("#redactor_link_url").focus()};this.opts.popover?this.popoverInit(RLANG.link,"link",350,t,i):this.modalInit(RLANG.link,"link",460,t,i)},insertLink:function(){var i=e("#redactor_tab_selected").val(),a="",n="",s="";"1"===i?(a=e("#redactor_link_url").val(),n=t(e("#redactor_link_url_text").val()),e("#redactor_link_blank").prop("checked")&&(s="_blank")):"2"===i?(a="mailto:"+e("#redactor_link_mailto").val(),n=t(e("#redactor_link_mailto_text").val())):"3"===i&&(a="#"+e("#redactor_link_anchor").val(),n=t(e("#redactor_link_anchor_text").val())),this._insertLink('<a href="'+a.replace(/"/g,"&quot;")+'" target="'+s+'">'+n+"</a>",e.trim(n),a,s)},_insertLink:function(t,i,a,n){this.restoreSelection(),""!==i&&(this.insert_link_node?(e(this.insert_link_node).text(i),e(this.insert_link_node).attr("href",a),""!==n&&e(this.insert_link_node).attr("target",n),this.syncCode()):this.insertOnCursorPosition("inserthtml",t)),this.modalClose()},showFile:function(){this.saveSelection();var t=e.proxy(function(){var t=this.getSelection(),i="";i=this.oldIE()?t.text:t.toString(),e("#redactor_filename").val(i),this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&e("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:e.proxy(function(e){this.fileUploadCallback(e)},this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:e.proxy(function(e){this.fileUploadCallback(e)},this)})},this);this.modalInit(RLANG.file,"file",500,t)},fileUploadCallback:function(t){if(this.restoreSelection(),t!==!1){var i=e.parseJSON(t),a=e("#redactor_filename").val();""===a&&(a=i.filename);var n='<a href="'+i.filelink+'">'+a+"</a>";e.browser.webkit&&window.chrome&&(n+="&nbsp;"),this.execCommand("inserthtml",n),"function"==typeof this.opts.fileUploadCallback&&this.opts.fileUploadCallback(this,i)}this.modalClose()},popoverInit:function(t,i,a,n,s){0===e("#redactor_modal").length&&(this.popover=e('<div id="redactor_modal" style="display: none;"><span id="redactor_arrow_top"></span><div id="redactor_modal_inner"></div></div>'),e(".redactor_toolbar").after(this.popover)),this.hdlModalClose=e.proxy(function(e){27===e.keyCode&&this.modalClose()},this),e(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),e("#redactor_modal_inner").html(this.opts["modal_"+i]),this.opts.overlay&&e("#redactor_modal").show(),e("#redactor_btn_modal_close").click(e.proxy(this.modalClose,this)).css({marginRight:"5px"}),"function"==typeof n&&n(),e("#redactor_tabs").hide();e("#redactor_modal").outerHeight(!0);this.isMobile()===!1?(e("#redactor_modal").css({width:a+"px",height:"auto",minHeight:"auto",position:"absolute",left:"62px","box-shadow":"0 3px 5px #ccc",top:"30px"}).fadeIn("fast"),this.modalSaveBodyOveflow=this.modalSaveBodyOveflow||e(document.body).css("overflow"),e(document.body).css("overflow","hidden")):e("#redactor_modal").css({width:"100%",height:"100%",margin:"0",minHeight:"300px",position:"absolute",left:"62px","box-shadow":"0 3px 5px #ccc",top:"30px"}).show(),e(".redactor_tab input").css({"line-height":"23px",border:"1px solid #ccc","border-radius":"3px"}),e("#redactor_modal_footer").css({padding:0}),"function"==typeof s&&s()},modalInit:function(t,i,a,n,s){if(0===e("#redactor_modal_overlay").length&&(this.overlay=e('<div id="redactor_modal_overlay" style="display: none;"></div>'),e("body").prepend(this.overlay)),0===e("#redactor_modal").length&&(this.modal=e('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'),e("body").append(this.modal)),e("#redactor_modal_close").click(e.proxy(this.modalClose,this)),this.hdlModalClose=e.proxy(function(e){27===e.keyCode&&this.modalClose()},this),e(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),e("#redactor_modal_inner").html(this.opts["modal_"+i]),e("#redactor_modal_header").html(t),this.opts.overlay&&(e("#redactor_modal_overlay").show(),0!=e("#redactor_modal form").data("overlayEvent")&&e("#redactor_modal_overlay").click(e.proxy(this.modalClose,this))),0!==e("#redactor_tabs").length){e("#redactor_tabs a").each(function(t,a){t++,e(a).click(function(){e("#redactor_tabs a").removeClass("redactor_tabs_act"),e(this).addClass("redactor_tabs_act"),e(".redactor_tab").slideUp("fast"),e("#redactor_tab"+t).slideDown("fast"),"image"==i&&2>=t?e("#redactor_upload_btn").hide():e("#redactor_upload_btn").show(),"image"==i&&2==t?e("#redactor_image_choose_help_text").show():e("#redactor_image_choose_help_text").hide(),e("#redactor_tab_selected").val(t)})})}e("#redactor_btn_modal_close").click(e.proxy(this.modalClose,this)),"function"==typeof n&&n();e("#redactor_modal").outerHeight(!0);this.isMobile()===!1?(e("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:a+"px",height:"auto",minHeight:"auto",marginTop:"-255px",marginLeft:"-"+(a+60)/2+"px"}).fadeIn("fast"),this.modalSaveBodyOveflow=this.modalSaveBodyOveflow||e(document.body).css("overflow"),e(document.body).css("overflow","hidden")):e("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),"function"==typeof s&&s()},modalClose:function(){e("#redactor_modal_close").unbind("click",this.modalClose),e("#redactor_modal").fadeOut("fast",e.proxy(function(){e("#redactor_modal_inner").html(""),this.opts.overlay&&(e("#redactor_modal_overlay").hide(),e("#redactor_modal_overlay").unbind("click",this.modalClose)),e(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose)},this)),this.isMobile()===!1&&(e(document.body).css("overflow",this.modalSaveBodyOveflow),this.modalSaveBodyOveflow=null)},setModalTab:function(t){e(".redactor_tab").hide();var i=e("#redactor_tabs a");i.removeClass("redactor_tabs_act"),i.eq(t-1).addClass("redactor_tabs_act"),e("#redactor_tab"+t).show()},uploadInit:function(t,i){this.uploadOptions={url:!1,success:!1,start:!1,trigger:!1,auto:!1,input:!1},e.extend(this.uploadOptions,i),0!==e("#"+t).length&&"INPUT"===e("#"+t).get(0).tagName?(this.uploadOptions.input=e("#"+t),this.element=e(e("#"+t).get(0).form)):this.element=e("#"+t),this.element_action=this.element.attr("action"),this.uploadOptions.auto?e(this.uploadOptions.input).change(e.proxy(function(){var t=e(this.uploadOptions.input).get(0).files[0];InlineImagesValidator.fileValidator(t)&&(this.element.submit(function(e){return!1}),this.uploadSubmit())},this)):this.uploadOptions.trigger&&e("#"+this.uploadOptions.trigger).click(e.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var t=document.createElement("div"),i='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';t.innerHTML=i,document.body.appendChild(t),this.uploadOptions.start&&this.uploadOptions.start();var a=this;return e("#"+this.id).load(function(){a.uploadLoaded.call(a,this)}),this.id},uploadForm:function(t,i){if(this.insertLoadingAtCaret(),this.uploadOptions.input){var a="redactorUploadForm"+this.id,n="redactorUploadFile"+this.id;this.form=e('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+i+'" name="'+a+'" id="'+a+'" enctype="multipart/form-data"></form>'),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&e.each(this.opts.uploadFields,e.proxy(function(t,i){0===i.indexOf("#")&&(i=e(i).val());var a=e('<input type="hidden" name="'+t+'" value="'+i+'">');e(this.form).append(a)},this));var s=this.uploadOptions.input,r=e(s).clone(),o=e('<input type="hidden" name="_uniquekey" value="'+this.uniqueKey+'">');e(s).attr("id",n),e(s).before(r),e(s).appendTo(this.form),o.appendTo(this.form),e(this.form).css("position","absolute"),e(this.form).css("top","-2000px"),e(this.form).css("left","-2000px"),e(this.form).appendTo("body"),add_csrf_token(this.form),this.form.submit()}else t.attr("target",i),t.attr("method","POST"),t.attr("enctype","multipart/form-data"),t.attr("action",this.uploadOptions.url),add_csrf_token(t),this.element.submit()},insertLoadingAtCaret:function(){this.modalClose(),this.$editor.focus(),this.restoreSelection(),this.uniqueKey=(new Date).getTime(),this.focusOnCursor();var t=e('<img src="'+uploaded_img_placeholder+'" class="image-loader" id="uploading_images_'+this.uniqueKey+'">');this.insertNodeAtCaret(t.get(0)),"function"==typeof this.opts.imageLoadingCallback?this.opts.imageLoadingCallback(this):this.disableFormWhileLoadingImage()},disableFormWhileLoadingImage:function(){this.$editor.parents("form").find('input[type="submit"]:not(:disabled), input[type="button"]:not(:disabled), button:not(:disabled)').addClass("load-disable").prop("disabled",!0)},enableFormAfterLoadingImage:function(){this.$editor.parents("form").find(".load-disable").prop("disabled",!1)},uploadLoaded:function(t){var i=e(t).contents().find("body").get(0);if(this.uploadOptions.success)if("undefined"!=typeof i){var a=i.innerHTML,n=a.match(/\{.*\}/)[0];this.uploadOptions.success(n)}else alert("Upload failed!"),this.$editor.find("img.image-loader").remove(),"function"==typeof this.opts.imageLoadedCallback?this.opts.imageLoadedCallback(this):this.enableFormAfterLoadingImage(),this.uploadOptions.success(!1);this.element.attr("action",this.element_action),this.element.attr("target","")},browser:function(e){var t=navigator.userAgent.toLowerCase(),i=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return"version"==e?i[2]:"webkit"==e?"chrome"==i[1]||"webkit"==i[1]:i[1]==e},oldIE:function(){return e.browser.msie&&parseInt(e.browser.version,10)<9?!0:!1},outerHTML:function(t){return e("<p>").append(e(t).eq(0).clone()).html()},normalize:function(e){return parseInt(e.replace("px",""),10)},isMobile:function(e){return e===!0&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1},cleanUpRedundant:function(){var t=this;e.each(this.$editor.find("[rel=tempredactor]"),function(){_element=e(this),e.each(["li","ol","ul","h1","h2","h3","h4","h5","h6"],function(){_element.text()==e.trim(_element.parent().text())&&_element.parent().is(this.toString())&&_element.parent().replaceWith(_element)}),e(this).css("font-weight","normal"),e(this).removeAttr("rel")}),e.each(this.$editor.find("span"),function(){"temp_redactor_font_size"==e(this).attr("rel")?(e(this).find("span").css("font-size",""),e(this).removeAttr("rel")):"temp_redactor_font_family"==e(this).attr("rel")&&(e(this).find("span").css("font-family",""),e(this).removeAttr("rel"))}),e.each(this.$editor.find("span"),function(){e(this).text()==e(this).parent().text()&&e(this).parent().is("span")&&(parentstyle=e(this).parent().attr("style"),childstyle=e(this).attr("style"),e(this).parent().attr("style",parentstyle+";"+childstyle),e(this).replaceWith(e(this).html()))}),e.each(this.$editor.find("span"),function(){var i=this;e.each(t.opts.spanCleanupProperties,function(e,a){t.compareParentStyles(i,a)}),(e(this).css("background-color")==e(this).parent().css("background-color")||e(this).css("background-color")==t.$editor.css("background-color")&&"transparent"==e(this).parent().css("background-color"))&&e(this).css("background-color","")}),this.syncCode()},inputEventAvailable:function(){return e.browser.webkit||e.browser.mozilla},compareParentStyles:function(t,i){i=e.trim(i),e.trim(e(t).css(i))==e.trim(e(t).parent().css(i))&&e(t).css(i,"")},placeCaretAtEnd:function(){var e=this.$editor.get(0);if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(e),a.collapse(!1),a.select()}},insertHtmlAtLast:function(e){this.placeCaretAtEnd(),this.insertHtml(e)}},e.fn.getEditor=function(){return this.data("redactor").$editor},e.fn.getCode=function(){return this.data("redactor").getCode()},e.fn.getText=function(){return this.data("redactor").$editor.text()},e.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()},e.fn.setCode=function(e){this.data("redactor").setCode(e)},e.fn.insertHtml=function(e){this.data("redactor").insertHtml(e)},e.fn.destroyEditor=function(){this.data("redactor").destroy(),this.removeData("redactor")},e.fn.setFocus=function(){this.data("redactor").$editor.focus()},e.fn.clearRichText=function(){var e=this.data("redactor");e.setCode(e.paragraphy(""))},e.fn.execCommand=function(e,t){this.data("redactor").execCommand(e,t)},e.fn.insertExternal=function(e){this.data("redactor").insertExternal(e)}}(jQuery),function(e){"use strict";function t(e){this.$editor=e,this.$form=this.$editor.$el.get(0).form}e.fn.removeCursorImage=function(){return this.each(function(){var e=new t(this);e.init()})},t.prototype={init:function(){"undefined"!=typeof Helpdesk&&Helpdesk.can_bind_first?jQuery(this.$form).bindFirst("submit",e.proxy(this.remove,this)):jQuery(this.$form).on("submit",e.proxy(this.remove,this))},remove:function(){this.$editor.removeCursorImage()}}}(window.jQuery),function(e){"use strict";function t(t,i){this.opts=e.extend({quote_class:"q-marker",remove_quote_class:"remove-quote",hover_container_class:"wrap-quoted-remove",template:"<div class='wrap-marker'></div>",tooltip_text:I18n.t("show_quoted_text"),tooltip_remove_quote:I18n.t("common_js_translations.remove_quoted_text")},i),this.$redactor=t,this.$redactor.$quoted=this,this.$quoted_area=e(this.$redactor.$el.data("quotedTextarea")),this.$remove_quote_marker=e("<span class='ficon-cross fsize-15 tooltip hide "+this.opts.remove_quote_class+"' title='"+this.opts.tooltip_remove_quote+"' />"),this.$quote_marker=e("<span class='"+this.opts.quote_class+" tooltip' title='"+this.opts.tooltip_text+"' />"),this.$template=e(this.opts.template),this.$hover_container=e("<span class='"+this.opts.hover_container_class+"'></span>").append(this.$quote_marker),this.$form=this.$redactor.$el.get(0).form,this.$quote_added=!1,this.$remove_tooltip_flag=!1,this.$remove_quote_option=this.$redactor.$el.data("removeQuote")}e.fn.quotedtext=function(e){return this.each(function(){var i=new t(this,e);i.init()})},t.prototype={init:function(){this.$remove_quote_option&&(e(this.$redactor.$box).delegate("."+this.opts.remove_quote_class,"click.quotedtext",e.proxy(this.removeQuotedText,this)),this.$hover_container.append(this.$remove_quote_marker),e(this.$redactor.$box).delegate("."+this.opts.hover_container_class,"mouseenter.quotedtext mouseleave.quotedtext",e.proxy(this.toggleRemoveOption,this))),this.$template.append(this.$hover_container),this.$template.insertAfter(this.$redactor.$editor),this.checkQuotedText(),e(this.$form).on("submit.quotedtext",e.proxy(this.syncQuotedText,this)),e(this.$redactor.$box).delegate("."+this.opts.quote_class,"click.quotedtext",e.proxy(this.insertQuotedText,this))},toggleRemoveOption:function(){this.$remove_quote_marker.toggle()},removeQuotedText:function(){e(".twipsy").remove(),this.$remove_tooltip_flag=!0,this.$template.remove()},insertQuotedText:function(){if("content"in document.createElement("template")){var t=document.importNode(this.$quoted_area[0].content,!0);t=e("<div></div>").append(t).append("<p><br /></p>"),this.$redactor.$editor.append(t.text())}else this.$redactor.insertHtmlAtLast(this.$quoted_area.val()+"<p><br /></p>");this.$redactor.syncCode(),this.checkQuotedText()},checkQuotedText:function(){this.$quote_added=this.$redactor.$editor.find(".freshdesk_quote").get(0)?!0:!1,this.$template.toggle(!this.$quote_added)},syncQuotedText:function(){if(!this.$quote_added&&!this.$remove_tooltip_flag){var t;if("content"in document.createElement("template")){var t=document.importNode(this.$quoted_area[0].content,!0);t=e(t).text()}else t=this.$quoted_area.val();var i=this.$redactor.$el.val()+t;this.$redactor.$el.val(i)}},reset:function(){this.$remove_quote_option=!1,this.$quote_added=!1,this.$remove_tooltip_flag=!1},destroy:function(){this.$remove_quote_option=!1,this.$quote_added=!1,this.$remove_tooltip_flag=!1,this.$template.remove(),e(this.$form).off(".quotedtext"),e(this.$redactor.$box).off(".quotedtext")}}}(window.jQuery),/*
	Plugin Drag and drop Upload v1.0.2
	http://imperavi.com/
	Copyright 2012, Imperavi Inc.
*/
function(e){"use strict";function t(t,i){this.opts=e.extend({url:!1,success:!1,preview:!1,uploadFields:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},i),this.$el=e(t)}e.fn.dragupload=function(e){return this.each(function(){var i=new t(this,e);i.init()})},t.prototype={init:function(){if(!e.browser.msie){this.droparea=e('<div class="redactor_droparea"></div>'),this.dropareabox=e('<div class="redactor_dropareabox"><span class="drop-text">'+this.opts.text+"</span></div>"),this.droparea.append(this.dropareabox),this.$el.parent().after(this.droparea);var t=this.$el.parent().remove();this.dropareabox.children(".drop-text").before(t),this.dropareabox.bind("dragover",e.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",e.proxy(function(){return this.ondragleave()},this)),this.dropareabox.get(0).ondrop=e.proxy(function(t){t.preventDefault(),this.opts.ondropCallback&&this.opts.ondropCallback(),this.dropareabox.removeClass("hover").addClass("drop");var i=t.dataTransfer.files[0];if(void 0!==i){var a=new FormData;if(this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&e.each(this.opts.uploadFields,e.proxy(function(t,i){"function"==typeof i?i=i():0===i.indexOf("#")&&(i=e(i).val()),a.append(t,i)},this)),!InlineImagesValidator.fileValidator(i))return this.opts.error('{"invalidFile": true,"alert":false}'),!0;a.append("image[uploaded_data]",i),e.ajax({dataType:"html",url:this.opts.url,data:a,cache:!1,contentType:!1,processData:!1,type:"POST",success:e.proxy(function(e){this.opts.success!==!1&&this.opts.success(e),this.opts.preview===!0&&this.dropareabox.html(e)},this),error:e.proxy(function(e){this.opts.error!==!1&&this.opts.error(e)},this)})}else this.opts.error('{"invalidFile": true}')},this)}},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(jQuery),function(e){"use strict";e.fn.linkify=function(){}}(jQuery),function(e){"use strict";function t(e,t){this.$editor=t,this.upload_url=this.$editor.opts.clipboardImageUpload,this.currentevent=e}jQuery.event.props.push("dataTransfer"),e.fn.pasteImage=function(e){return this.each(function(){var i=new t(e,this);i.init()})},t.prototype={init:function(){this.bindCustomEvent(),"paste"==this.currentevent.type?this.pasteContent():this.dropedContent()},pasteContent:function(){var t,i,a,n,s=this,r=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);if(r)return this.currentevent.preventDefault(),!1;if(null!=(null!=(i=this.currentevent.originalEvent)?i.clipboardData:void 0))if(t=this.currentevent.originalEvent.clipboardData,this.currentevent.preventDefault(),t.items){var o=t.items,l=o[0].getAsFile();s.loadImageFileAsURL(l)}else this.$editor.saveSelection(),this.$editor.insertLoadingAtCaret(),e('[rel="getPasteImage"]').focus(),setTimeout(function(){var t=e("<div />").html(e('[rel="getPasteImage"]').html()),i=t.find("img")[0];e('[rel="getPasteImage"]').html(""),s.$editor.$el.trigger("pasteImage",{dataURI:i.src,uniqueKey:s.$editor.uniqueKey})},500);if(t=window.clipboardData){var c=t.files;for(a=0,n=c.length;n>a;a++){var d=c[a];s.loadImageFileAsURL(d),s.currentevent.preventDefault()}}},dropedContent:function(){var t=this.currentevent.originalEvent.dataTransfer.files,i=this;void 0!=t&&t.length>0&&(i.currentevent.preventDefault(),e.each(t,function(e,t){InlineImagesValidator.fileValidator(t)&&i.loadImageFileAsURL(t)}))},loadImageFileAsURL:function(e){var t=this,i=new FileReader;i.onload=function(e){t.handleImage(e.target.result)},i.readAsDataURL(e)},handleImage:function(e){this.$editor.saveSelection(),this.$editor.insertLoadingAtCaret(),this.currentevent.preventDefault(),this.$editor.$el.trigger("pasteImage",{dataURI:e,uniqueKey:this.$editor.uniqueKey})},bindCustomEvent:function(){var e=this;this.$editor.$el.off("pasteImage"),this.$editor.$el.on("pasteImage",function(t,i){e.saveImage(i),t.preventDefault()})},saveImage:function(t){var i=this.$editor,a={dataURI:t.dataURI,_uniquekey:t.uniqueKey};e.ajax({dataType:"json",url:this.upload_url,data:a,type:"POST",success:e.proxy(function(e){e=JSON.stringify(e),i.imageUploadCallback(e)},this),error:e.proxy(function(e){console.log(e),e=JSON.stringify(e),i.imageUploadCallback(e)},this)})}}}(window.jQuery),function(e){function t(){this.validType=["image/jpeg","image/png","image/tiff","image/tiff","image/gif"],this.validExtensions=["jpeg","jpg","png","tif","tiff","giff"]}t.prototype={fileValidator:function(e){return this.validType.indexOf(e.type)<0?!1:!0},cleanSvg:function(e){return e.replace(/<img(.*?)src="(.*?).svg(.*?)">/g,"")},link:function(e){return e.toLowerCase().indexOf(".svg")>-1?!1:!0}},InlineImagesValidator=new t}(window.jQuery),function(e){e.event.special.textselect={setup:function(t,i){e(this).data("textselected",!1),e(this).data("ttt",t),e(this).bind("mouseup",e.event.special.textselect.handler)},teardown:function(t){e(this).unbind("mouseup",e.event.special.textselect.handler)},handler:function(t){var i=e(this).data("ttt"),a=e.event.special.textselect.getSelectedText(i).toString();""!=a&&(e(this).data("textselected",!0),t.type="textselect",t.text=a,e.event.handle.apply(this,arguments))},getSelectedText:function(e){var t="";return window.getSelection?t=window.getSelection():document.getSelection?t=document.getSelection():document.selection&&(t=document.selection.createRange().text),t}},e.event.special.textunselect={setup:function(t,i){e(this).data("rttt",t),e(this).data("textselected",!1),e(this).bind("mouseup",e.event.special.textunselect.handler),e(this).bind("keyup",e.event.special.textunselect.handlerKey)},teardown:function(t){e(this).unbind("mouseup",e.event.special.textunselect.handler)},handler:function(t){if(e(this).data("textselected")){var i=e(this).data("rttt"),a=e.event.special.textselect.getSelectedText(i).toString();""==a&&(e(this).data("textselected",!1),t.type="textunselect",e.event.handle.apply(this,arguments))}},handlerKey:function(t){if(e(this).data("textselected")){var i=e(this).data("rttt"),a=e.event.special.textselect.getSelectedText(i).toString();(t.keyCode=27)&&""==a&&(e(this).data("textselected",!1),t.type="textunselect",e.event.handle.apply(this,arguments))}}}}(jQuery);var inlineImageUploadCallback=function(e,t){var i=e.$el.parents("form"),a=e.$el.attr("name").replace(/\[.*\]/g,""),n=jQuery('<input type="hidden">').attr({name:a+"[inline_attachment_ids][]",value:t.fileid,"class":"inline-attachment-input"});i.append(n)};